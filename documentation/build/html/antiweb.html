

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Antiweb documentation &mdash; antiweb 0.3.3 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="antiweb 0.3.3 documentation" href="index.html"/>
        <link rel="next" title="antisphinx" href="antisphinx.html"/>
        <link rel="prev" title="Process overview" href="process_overview.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> antiweb
          

          
          </a>

          
            
            
              <div class="version">
                0.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="process_overview.html">Process overview</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Antiweb documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#objects">Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="#directives">Directives</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#directive">Directive</a></li>
<li class="toctree-l3"><a class="reference internal" href="#namedirective">NameDirective</a></li>
<li class="toctree-l3"><a class="reference internal" href="#start">Start</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rstart">RStart</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cstart">CStart</a></li>
<li class="toctree-l3"><a class="reference internal" href="#end">End</a></li>
<li class="toctree-l3"><a class="reference internal" href="#include">Include</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rinclude">RInclude</a></li>
<li class="toctree-l3"><a class="reference internal" href="#code">Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="#edoc">Edoc</a></li>
<li class="toctree-l3"><a class="reference internal" href="#if">If</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fi">Fi</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ignore">Ignore</a></li>
<li class="toctree-l3"><a class="reference internal" href="#define">Define</a></li>
<li class="toctree-l3"><a class="reference internal" href="#enifed">Enifed</a></li>
<li class="toctree-l3"><a class="reference internal" href="#subst">Subst</a></li>
<li class="toctree-l3"><a class="reference internal" href="#indent">Indent</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#readers">Readers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#reader">Reader</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creader">CReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="#csharpreader">CSharpReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pythonreader">PythonReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="#clojurereader">ClojureReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="#genericreader">GenericReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rstreader">rstReader</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#document">Document</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">Document</a></li>
<li class="toctree-l3"><a class="reference internal" href="#line">Line</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#file-layout">File Layout</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#writing-the-documentation-files">Writing the documentation files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#process-file">process_file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#search-for-generated-block">search_for_generated_block</a></li>
<li class="toctree-l3"><a class="reference internal" href="#imports">&lt;&lt;imports&gt;&gt;</a></li>
<li class="toctree-l3"><a class="reference internal" href="#management">&lt;&lt;management&gt;&gt;</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">&lt;&lt;directives&gt;&gt;</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">&lt;&lt;readers&gt;&gt;</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">&lt;&lt;document&gt;&gt;</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#multi-file-processing-and-sphinx-support">Multi-File Processing and Sphinx Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-add-new-languages">How to add new languages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#language-specific-comment-markers">Language specific comment markers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="antisphinx.html">antisphinx</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="motivation.html">Why another literate programming tool?</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">antiweb</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Antiweb documentation</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/antiweb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="antiweb-documentation">
<h1>Antiweb documentation<a class="headerlink" href="#antiweb-documentation" title="Permalink to this headline">¶</a></h1>
<p>If you just want to generate the documentation from a source file use
the following function:</p>
<dl class="function">
<dt id="generate">
<code class="descname">generate</code><span class="sig-paren">(</span><em>fname</em>, <em>tokens</em>, <em>warnings</em><span class="sig-paren">)</span><a class="headerlink" href="#generate" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a rst file from a source file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>fname</strong> (<a class="reference external" href="https://docs.python.org/2/library/string.html#module-string" title="(in Python v2.7)"><em>string</em></a>) &#8211; The path to the source file.</li>
<li><strong>tokens</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#list" title="(in Python v2.7)"><em>list</em></a>) &#8211; A list of string tokens, used for &#64;if directives.</li>
<li><strong>show_warnings</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) &#8211; Warnings will be written
via the logging module.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">tokens</span><span class="p">,</span> <span class="n">show_warnings</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;file not found: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">lexer</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">get_lexer_for_filename</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="c1">#get the language specific comment markers based on the pygments lexer name</span>
    <span class="n">single_comment_markers</span><span class="p">,</span>  <span class="n">block_comment_markers</span> <span class="o">=</span> <span class="n">get_comment_markers</span><span class="p">(</span><span class="n">lexer</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="c1">#initialise a new Reader based on the pygments lexer name</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">readers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">lexer</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">Reader</span><span class="p">)(</span><span class="n">lexer</span><span class="p">,</span> <span class="n">single_comment_markers</span><span class="p">,</span>  <span class="n">block_comment_markers</span><span class="p">)</span>

    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">tokens</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">document</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">show_warnings</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

<div class="section" id="objects">
<h2>Objects<a class="headerlink" href="#objects" title="Permalink to this headline">¶</a></h2>
<div class="compound">
<p class="compound-first">The graph below show the main objects of antiweb:</p>
<img src="_images/graphviz-cd85d7b2fc0bf6b875b662a2b5b236658df9f2af.png" alt="digraph collaboration {
document [shape=box, label=&quot;document&quot;]
reader   [shape=box, label=&quot;reader&quot;]
directives [shape=box, label=&quot;directive&quot; ]
blocks [shape=box]
lines [shape=box]

document -&gt; reader [label=&quot;uses&quot;]
reader -&gt; directives [label=&quot;creates&quot;]
document -&gt; directives [label=&quot;uses&quot;]
document -&gt; blocks [label=&quot;contains&quot;]
directives -&gt; blocks [label=&quot;prepare&quot;]
blocks -&gt; lines [label=&quot;contains&quot;]
lines -&gt; directives [label=&quot;contains&quot;]
}" />
<p class="compound-last">The <a class="reference internal" href="#Document" title="Document"><code class="xref py py-class docutils literal"><span class="pre">document</span></code></a> manages the complete transformation: It uses a
<a class="reference internal" href="#Reader" title="Reader"><code class="xref py py-class docutils literal"><span class="pre">reader</span></code></a>  to parse source code. The <a class="reference internal" href="#Reader" title="Reader"><code class="xref py py-class docutils literal"><span class="pre">reader</span></code></a>
creates <a class="reference internal" href="#directives"><span class="std std-ref">directives</span></a> objects for each found antiweb directive in the source
code. The source code is split in text blocks which consists of several
<a class="reference internal" href="#Line" title="Line"><code class="xref py py-class docutils literal"><span class="pre">lines</span></code></a>. The <a class="reference internal" href="#Document" title="Document"><code class="xref py py-class docutils literal"><span class="pre">document</span></code></a> process all
<a class="reference internal" href="#directives"><span class="std std-ref">directives</span></a>  to generate the output document.</p>
</div>
</div>
<div class="section" id="directives">
<span id="id1"></span><h2>Directives<a class="headerlink" href="#directives" title="Permalink to this headline">¶</a></h2>
<div class="section" id="directive">
<h3>Directive<a class="headerlink" href="#directive" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="Directive">
<em class="property">class </em><code class="descname">Directive</code><span class="sig-paren">(</span><em>line</em><span class="optional">[</span>, <em>mo</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Directive" title="Permalink to this definition">¶</a></dt>
<dd><p>The base class of all directives.
Directives can be distinguished by the different tasks,
they handle, these Task are generally:</p>
<blockquote>
<div><ul class="simple">
<li>identifying a text block (<a class="reference internal" href="#Directive.collect_block" title="Directive.collect_block"><code class="xref py py-meth docutils literal"><span class="pre">collect_block()</span></code></a>)</li>
<li>inserting text in the output (<a class="reference internal" href="#Directive.process" title="Directive.process"><code class="xref py py-meth docutils literal"><span class="pre">process()</span></code></a>)</li>
<li>modifying text in the output (<a class="reference internal" href="#Directive.process" title="Directive.process"><code class="xref py py-meth docutils literal"><span class="pre">process()</span></code></a>)</li>
<li>deleting text in the output (<a class="reference internal" href="#Directive.process" title="Directive.process"><code class="xref py py-meth docutils literal"><span class="pre">process()</span></code></a>)</li>
</ul>
</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>line</strong> &#8211; the line number the directive was found</li>
<li><strong>mo</strong> &#8211; a match object of an regular expression</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Directive</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="c1">#Attributes</span>
    <span class="o">&lt;&lt;</span><span class="n">Directive</span><span class="o">.</span><span class="n">expression</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Directive</span><span class="o">.</span><span class="n">priority</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Directive</span><span class="o">.</span><span class="n">line</span><span class="o">&gt;&gt;</span>

    <span class="c1">#Methods</span>
    <span class="o">&lt;&lt;</span><span class="n">Directive</span><span class="o">.</span><span class="n">__init__</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Directive</span><span class="o">.</span><span class="n">collect_block</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Directive</span><span class="o">.</span><span class="n">process</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Directive</span><span class="o">.</span><span class="n">match</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Directive</span><span class="o">.</span><span class="n">__repr__</span><span class="o">&gt;&gt;</span>
</pre></div>
</td></tr></table></div>
<dl class="attribute">
<dt id="Directive.expression">
<code class="descname">expression</code><a class="headerlink" href="#Directive.expression" title="Permalink to this definition">¶</a></dt>
<dd><p>A regular expression defining the directive.</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">expression</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="Directive.priority">
<code class="descname">priority</code><a class="headerlink" href="#Directive.priority" title="Permalink to this definition">¶</a></dt>
<dd><p>An integer process priority. Directives with a lower priority
will be processed earlier.</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">priority</span> <span class="o">=</span> <span class="mi">10</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="Directive.line">
<code class="descname">line</code><a class="headerlink" href="#Directive.line" title="Permalink to this definition">¶</a></dt>
<dd><p>A integer defining the original line number of the directive.</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">line</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Directive.__init__">
<code class="descname">__init__</code><span class="sig-paren">(</span><em>line</em><span class="optional">[</span>, <em>mo</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Directive.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>The constructor</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">mo</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">line</span> <span class="o">=</span> <span class="n">line</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Directive.collect_block">
<code class="descname">collect_block</code><span class="sig-paren">(</span><em>document</em>, <em>index</em><span class="sig-paren">)</span><a class="headerlink" href="#Directive.collect_block" title="Permalink to this definition">¶</a></dt>
<dd><p>This method is called by <a class="reference internal" href="#Document" title="Document"><code class="xref py py-class docutils literal"><span class="pre">Document</span></code></a>.
If the directive is defining a text block. It
retrieves the text lines of the block from the document
and return them.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>document</strong> (<a class="reference internal" href="#Document" title="Document"><code class="xref py py-class docutils literal"><span class="pre">Document</span></code></a>) &#8211; the document calling the function.</li>
<li><strong>index</strong> (<em>integer</em>) &#8211; the line index of the directive.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">If the directive collects a block the return value
is a tuple <code class="docutils literal"><span class="pre">(directive</span> <span class="pre">name,</span> <span class="pre">block</span> <span class="pre">of</span> <span class="pre">lines)</span></code>, or
<code class="docutils literal"><span class="pre">None</span></code> otherwise.</p>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">collect_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Directive.process">
<code class="descname">process</code><span class="sig-paren">(</span><em>document</em>, <em>block</em>, <em>index</em><span class="sig-paren">)</span><a class="headerlink" href="#Directive.process" title="Permalink to this definition">¶</a></dt>
<dd><p>This method is called by <a class="reference internal" href="#Document" title="Document"><code class="xref py py-class docutils literal"><span class="pre">Document</span></code></a>.
The directive should do whatever it is supposed to do.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>document</strong> (<a class="reference internal" href="#Document" title="Document"><code class="xref py py-class docutils literal"><span class="pre">Document</span></code></a>) &#8211; the document calling the function.</li>
<li><strong>block</strong> &#8211; The line block the directive is in.</li>
<li><strong>index</strong> (<em>integer</em>) &#8211; the line index of the directive
within the block.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Directive.match">
<code class="descname">match</code><span class="sig-paren">(</span><em>lines</em><span class="sig-paren">)</span><a class="headerlink" href="#Directive.match" title="Permalink to this definition">¶</a></dt>
<dd><p>This method is called by <a class="reference internal" href="#Document" title="Document"><code class="xref py py-class docutils literal"><span class="pre">Document</span></code></a>.
It gives the directive the chance to find and manipulate other
directives.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>lines</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#list" title="(in Python v2.7)"><em>list</em></a>) &#8211; a list of all document lines.</td>
</tr>
</tbody>
</table>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Directive.__repr__">
<code class="descname">__repr__</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Directive.__repr__" title="Permalink to this definition">¶</a></dt>
<dd><p>returns a textual representation of the directive.</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">%s</span><span class="s2"> at </span><span class="si">%i</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="namedirective">
<h3>NameDirective<a class="headerlink" href="#namedirective" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="NameDirective">
<em class="property">class </em><code class="descname">NameDirective</code><span class="sig-paren">(</span><em>line</em>, <em>mo</em><span class="sig-paren">)</span><a class="headerlink" href="#NameDirective" title="Permalink to this definition">¶</a></dt>
<dd><p>The base class for directives with a name argument.
It inherits <a class="reference internal" href="#Directive" title="Directive"><code class="xref py py-class docutils literal"><span class="pre">Directive</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>line</strong> &#8211; the line number the directive was found</li>
<li><strong>mo</strong> &#8211; a match object of an regular expression or
a string defining the name.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt id="NameDirective.name">
<code class="descname">name</code><a class="headerlink" href="#NameDirective.name" title="Permalink to this definition">¶</a></dt>
<dd><p>A string defining the argument of the directive.</p>
</dd></dl>

<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">NameDirective</span><span class="p">(</span><span class="n">Directive</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">mo</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NameDirective</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">mo</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mo</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">mo</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">mo</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">) </span><span class="si">%i</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
<div class="section" id="start">
<h3>Start<a class="headerlink" href="#start" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="Start">
<em class="property">class </em><code class="descname">Start</code><a class="headerlink" href="#Start" title="Permalink to this definition">¶</a></dt>
<dd><p>This class represents a <code class="docutils literal"><span class="pre">&#64;start</span></code> directive. It inherits
<a class="reference internal" href="#NameDirective" title="NameDirective"><code class="xref py py-class docutils literal"><span class="pre">NameDirective</span></code></a>.</p>
<p>The <code class="docutils literal"><span class="pre">&#64;start</span></code> directive defines the beginning of
a text block. It is called with an argument defining
the name of the text block. There are two special text
blocks:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">()</span></code> The empty one defining the main text block</li>
<li><code class="docutils literal"><span class="pre">(__macro__)</span></code> defining a text block for implementing macros.</li>
</ul>
</div></blockquote>
<p>There are several possibilities to end a text block.</p>
<blockquote>
<div><ol class="arabic simple">
<li>The end of the file</li>
<li>A line with a smaller indentation as the <code class="docutils literal"><span class="pre">&#64;start</span></code> directive.</li>
<li>Another start directive with same indentation.</li>
<li>An unnamed end (<code class="docutils literal"><span class="pre">&#64;</span></code>) directive with the same indentation as
the <code class="docutils literal"><span class="pre">&#64;start</span></code> directive.</li>
<li>A named end directive closing this block or an outer block.</li>
</ol>
</div></blockquote>
<p>Text blocks defined by <code class="docutils literal"><span class="pre">&#64;start</span></code> can be nested.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Start</span><span class="p">(</span><span class="n">NameDirective</span><span class="p">):</span>
    <span class="c1">#Attributes</span>
    <span class="o">&lt;&lt;</span><span class="n">Start</span><span class="o">.</span><span class="n">has_named_end</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Start</span><span class="o">.</span><span class="n">inherited</span> <span class="n">attributes</span><span class="o">&gt;&gt;</span>

    <span class="c1">#Methods</span>
    <span class="o">&lt;&lt;</span><span class="n">Start</span><span class="o">.</span><span class="n">_find_matching_end</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Start</span><span class="o">.</span><span class="n">collect_block</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Start</span><span class="o">.</span><span class="n">process</span><span class="o">&gt;&gt;</span>
</pre></div>
</td></tr></table></div>
<dl class="attribute">
<dt id="Start.has_named_end">
<code class="descname">has_named_end</code><a class="headerlink" href="#Start.has_named_end" title="Permalink to this definition">¶</a></dt>
<dd><p>A boolean value, signalizing if the directive is
ended by a named end directive.</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">has_named_end</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
</dd></dl>

<p id="start-inherited-attributes"><strong>&lt;&lt;Start.inherited attributes&gt;&gt;</strong></p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">expression</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;@start\((.*)\)&quot;</span><span class="p">)</span>
<span class="n">priority</span> <span class="o">=</span> <span class="mi">5</span>
</pre></div>
</div>
<dl class="method">
<dt id="Start.collect_block">
<code class="descname">collect_block</code><span class="sig-paren">(</span><em>document</em>, <em>index</em><span class="sig-paren">)</span><a class="headerlink" href="#Start.collect_block" title="Permalink to this definition">¶</a></dt>
<dd><p>See <a class="reference internal" href="#Directive.collect_block" title="Directive.collect_block"><code class="xref py py-meth docutils literal"><span class="pre">Directive.collect_block()</span></code></a>.
The returned lines are unindented to column 0.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">collect_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_matching_end</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="n">index</span><span class="p">:])</span>
    <span class="n">block</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">index</span><span class="o">+</span><span class="n">end</span><span class="p">]</span>

    <span class="n">reduce_block</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="n">block</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">reduce_block</span><span class="p">:</span>
        <span class="n">document</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">,</span> <span class="s2">&quot;Empty &#39;</span><span class="si">%s</span><span class="s2">&#39; block&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1">#unindent the block, empty lines may not count (filter(bool, block))</span>
    <span class="n">indent_getter</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">attrgetter</span><span class="p">(</span><span class="s2">&quot;indent&quot;</span><span class="p">)</span>
    <span class="n">min_indent</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">indent_getter</span><span class="p">,</span> <span class="n">reduce_block</span><span class="p">)))</span>
    <span class="n">block</span> <span class="o">=</span> <span class="p">[</span> <span class="n">l</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">change_indent</span><span class="p">(</span><span class="o">-</span><span class="n">min_indent</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">block</span> <span class="p">]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">block</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

<dl class="method">
<dt id="Start.process">
<code class="descname">process</code><span class="sig-paren">(</span><em>document</em>, <em>block</em>, <em>index</em><span class="sig-paren">)</span><a class="headerlink" href="#Start.process" title="Permalink to this definition">¶</a></dt>
<dd><p>See <a class="reference internal" href="#Directive.process" title="Directive.process"><code class="xref py py-meth docutils literal"><span class="pre">Directive.process()</span></code></a>.
Removes all lines of the text block from
the containing block.</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_matching_end</span><span class="p">(</span><span class="n">block</span><span class="p">[</span><span class="n">index</span><span class="p">:])</span>
    <span class="k">del</span> <span class="n">block</span><span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="n">index</span><span class="o">+</span><span class="n">end</span><span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Start._find_matching_end">
<code class="descname">_find_matching_end</code><span class="sig-paren">(</span><em>block</em><span class="sig-paren">)</span><a class="headerlink" href="#Start._find_matching_end" title="Permalink to this definition">¶</a></dt>
<dd><p>Finds the matching end for the text block.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>block</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#list" title="(in Python v2.7)"><em>list</em></a>) &#8211; A list of lines beginning with start</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">The line index of the found end.</td>
</tr>
</tbody>
</table>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_find_matching_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_named_end</span><span class="p">:</span>
        <span class="c1"># ignore all other ending conditions and directly</span>
        <span class="c1"># find the matching end directive</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">block</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
            <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">directive</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">End</span><span class="p">)</span> <span class="ow">and</span> <span class="n">d</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">j</span>

    <span class="n">start_indent</span> <span class="o">=</span> <span class="n">block</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">indent</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">block</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
        <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">lindent</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">indent</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">directive</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">End</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">lindent</span> <span class="o">==</span> <span class="n">start_indent</span><span class="p">:</span>
                <span class="c1">#case 4: An unnamed @ directive with the same indentation</span>
                <span class="c1">#        as the @start directive.</span>
                <span class="k">return</span> <span class="n">j</span>

            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">start_line</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">:</span>
                <span class="c1">#case 5: A named @ directive closing this block</span>
                <span class="c1">#        or an outer block.</span>
                <span class="k">return</span> <span class="n">j</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">Start</span><span class="p">)</span> <span class="ow">and</span> <span class="n">lindent</span> <span class="o">==</span> <span class="n">start_indent</span><span class="p">:</span>
            <span class="c1">#case 3: Another @start directive with same indentation.</span>
            <span class="k">return</span> <span class="n">j</span>

        <span class="k">if</span> <span class="n">lindent</span> <span class="o">&lt;</span> <span class="n">start_indent</span> <span class="ow">and</span> <span class="n">l</span><span class="p">:</span>
            <span class="c1">#case 2: A line with a smaller indentation as the @start directive.</span>
            <span class="c1">#        (an empty line doesn&#39;t count)</span>
            <span class="k">return</span> <span class="n">j</span>

    <span class="c1">#case 1: The end of the file</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="rstart">
<h3>RStart<a class="headerlink" href="#rstart" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="RStart">
<em class="property">class </em><code class="descname">RStart</code><a class="headerlink" href="#RStart" title="Permalink to this definition">¶</a></dt>
<dd><p>This class represents a <code class="docutils literal"><span class="pre">&#64;rstart</span></code> directive. It inherits
<a class="reference internal" href="#Start" title="Start"><code class="xref py py-class docutils literal"><span class="pre">Start</span></code></a>.</p>
<p>The <code class="docutils literal"><span class="pre">&#64;rstart</span></code> directive works like the <code class="docutils literal"><span class="pre">&#64;start</span></code>
directive. While <code class="docutils literal"><span class="pre">&#64;start</span></code> removes it&#8217;s block completely
from the containing block. <code class="docutils literal"><span class="pre">&#64;rstart</span></code> replaces the lines
with a <code class="docutils literal"><span class="pre">&lt;&lt;name&gt;&gt;</span></code> - Sentinel.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">RStart</span><span class="p">(</span><span class="n">Start</span><span class="p">):</span>
    <span class="n">expression</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;@rstart\((.*)\)&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_matching_end</span><span class="p">(</span><span class="n">block</span><span class="p">[</span><span class="n">index</span><span class="p">:])</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">block</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">block</span><span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="n">index</span><span class="o">+</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="n">line</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s2">&quot;&lt;&lt;</span><span class="si">%s</span><span class="s2">&gt;&gt;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="p">]</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
<div class="section" id="cstart">
<h3>CStart<a class="headerlink" href="#cstart" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="CStart">
<em class="property">class </em><code class="descname">CStart</code><a class="headerlink" href="#CStart" title="Permalink to this definition">¶</a></dt>
<dd><p>This class represents a <code class="docutils literal"><span class="pre">&#64;rstart</span></code> directive. It inherits
<a class="reference internal" href="#RStart" title="RStart"><code class="xref py py-class docutils literal"><span class="pre">RStart</span></code></a>.</p>
<p>The <code class="docutils literal"><span class="pre">&#64;cstart(name)</span></code> directive is a replacement for</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="nd">@rstart</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="nd">@code</span>
</pre></div>
</div>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CStart</span><span class="p">(</span><span class="n">RStart</span><span class="p">):</span>
    <span class="n">expression</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;@cstart\((.*)\)&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">collect_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="n">name_block</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">CStart</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">collect_block</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">name_block</span><span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>

        <span class="n">name</span><span class="p">,</span> <span class="n">block</span> <span class="o">=</span> <span class="n">name_block</span>

        <span class="n">first</span> <span class="o">=</span> <span class="n">block</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sd</span> <span class="o">=</span> <span class="p">[</span> <span class="n">Code</span><span class="p">(</span><span class="n">first</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="p">]</span>
        <span class="n">block</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">first</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s2">&quot;@code&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">directives</span><span class="o">=</span><span class="n">sd</span><span class="p">,</span>
                                                <span class="n">index</span><span class="o">=</span><span class="n">first</span><span class="o">.</span><span class="n">index</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">name</span><span class="p">,</span> <span class="n">block</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
<div class="section" id="end">
<h3>End<a class="headerlink" href="#end" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="End">
<em class="property">class </em><code class="descname">End</code><a class="headerlink" href="#End" title="Permalink to this definition">¶</a></dt>
<dd><p>This class represents an end directive. It inherits
<a class="reference internal" href="#NameDirective" title="NameDirective"><code class="xref py py-class docutils literal"><span class="pre">NameDirective</span></code></a>.</p>
<p>The end (<code class="docutils literal"><span class="pre">&#64;</span></code>) directive ends a text block.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">End</span><span class="p">(</span><span class="n">NameDirective</span><span class="p">):</span>
    <span class="n">expression</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;@(\((.*)\))?\s*$&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">mo</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NameDirective</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">mo</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mo</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">mo</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">mo</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span>

        <span class="c1">#find the matching start and inform it for the named end</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">lines</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">l</span><span class="o">.</span><span class="n">directives</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">Start</span><span class="p">)</span> <span class="ow">and</span> <span class="n">d</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                    <span class="n">d</span><span class="o">.</span><span class="n">has_named_end</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">start_line</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">line</span>
                    <span class="k">return</span>


    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="c1">#completely remove the directive from the containing block</span>
        <span class="k">del</span> <span class="n">block</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
<div class="section" id="include">
<h3>Include<a class="headerlink" href="#include" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="Include">
<em class="property">class </em><code class="descname">Include</code><a class="headerlink" href="#Include" title="Permalink to this definition">¶</a></dt>
<dd><p>This class represents an <code class="docutils literal"><span class="pre">&#64;include</span></code> directive. It inherits
<a class="reference internal" href="#NameDirective" title="NameDirective"><code class="xref py py-class docutils literal"><span class="pre">NameDirective</span></code></a>.</p>
<p>The <code class="docutils literal"><span class="pre">&#64;include</span></code> directive inserts the contents of the
text block with the same name. The lines have the same
indentation as the <code class="docutils literal"><span class="pre">&#64;include</span></code> directive.</p>
<p>The directive can have a second <em>file</em> argument. If given
the directive inserts the text block of the specified file.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Include</span><span class="p">(</span><span class="n">NameDirective</span><span class="p">):</span>
    <span class="n">expression</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;@include\((.+)\)&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="c1">#check if the name contains 2 arguments</span>
        <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="n">document</span><span class="o">.</span><span class="n">blocks_included</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="c1">#a file name is given, fetch block from that file</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">subdoc</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">get_subdoc</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">subdoc</span><span class="p">:</span>
                <span class="n">include</span> <span class="o">=</span> <span class="n">subdoc</span><span class="o">.</span><span class="n">get_compiled_block</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">include</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">include</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">get_compiled_block</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">include</span><span class="p">:</span>
            <span class="c1">#print &quot;error include&quot;, self.line, name</span>
            <span class="n">document</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">,</span>
                               <span class="s2">&quot;Cannot find text block: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1">#replace the directive with its content</span>
        <span class="n">indent</span> <span class="o">=</span> <span class="n">block</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">indent</span>
        <span class="n">include</span> <span class="o">=</span> <span class="p">[</span> <span class="n">l</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">change_indent</span><span class="p">(</span><span class="n">indent</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">include</span> <span class="p">]</span>
        <span class="n">block</span><span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">include</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
<div class="section" id="rinclude">
<h3>RInclude<a class="headerlink" href="#rinclude" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="RInclude">
<em class="property">class </em><code class="descname">RInclude</code><a class="headerlink" href="#RInclude" title="Permalink to this definition">¶</a></dt>
<dd><p>This class represents an <code class="docutils literal"><span class="pre">&#64;rinclude</span></code> directive. It inherits
<a class="reference internal" href="#Include" title="Include"><code class="xref py py-class docutils literal"><span class="pre">Include</span></code></a>.</p>
<p>The <code class="docutils literal"><span class="pre">&#64;rinclude(text</span> <span class="pre">block</span> <span class="pre">name)</span></code> directive is a is a replacement for:</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">_text</span> <span class="n">block</span> <span class="n">name</span><span class="p">:</span>

<span class="o">**&lt;&lt;</span><span class="n">text</span> <span class="n">block</span> <span class="n">name</span><span class="o">&gt;&gt;**</span>

<span class="nd">@include</span><span class="p">(</span><span class="n">text</span> <span class="n">block</span> <span class="n">name</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">RInclude</span><span class="p">(</span><span class="n">Include</span><span class="p">):</span>
    <span class="n">expression</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;@rinclude\((.+)\)&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">block</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RInclude</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>

        <span class="n">block</span><span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="n">l</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">),</span>
                               <span class="n">l</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s2">&quot;.. _</span><span class="si">%s</span><span class="s2">:&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                               <span class="n">l</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">),</span>
                               <span class="n">l</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s2">&quot;**&lt;&lt;</span><span class="si">%s</span><span class="s2">&gt;&gt;**&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                               <span class="n">l</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="p">]</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
<div class="section" id="code">
<h3>Code<a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="Code">
<em class="property">class </em><code class="descname">Code</code><a class="headerlink" href="#Code" title="Permalink to this definition">¶</a></dt>
<dd><p>This class represents an <code class="docutils literal"><span class="pre">&#64;code</span></code> directive. It inherits
<a class="reference internal" href="#Directive" title="Directive"><code class="xref py py-class docutils literal"><span class="pre">Directive</span></code></a>.</p>
<p>The <code class="docutils literal"><span class="pre">&#64;code</span></code> directive starts a code block. All
lines following <code class="docutils literal"><span class="pre">&#64;code</span></code> will be displayed as source code.</p>
<dl class="docutils">
<dt>A <code class="docutils literal"><span class="pre">&#64;code</span></code> directive ends,</dt>
<dd><ul class="first last simple">
<li>if the text block ends</li>
<li>if an <code class="docutils literal"><span class="pre">&#64;edoc</span></code> occurs.</li>
</ul>
</dd>
</dl>
<p>The content of the special macro <code class="docutils literal"><span class="pre">__codeprefix__</span></code> is inserted
before each code block. <code class="docutils literal"><span class="pre">__codeprefix__</span></code> is empty by default
and can be defined by a <code class="docutils literal"><span class="pre">&#64;define</span></code> directive.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Code</span><span class="p">(</span><span class="n">Directive</span><span class="p">):</span>
    <span class="n">expression</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;@code&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">block</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

        <span class="c1">#change the indentation the code lines</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">block</span><span class="p">)):</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">block</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">directive</span><span class="p">,</span> <span class="n">Edoc</span><span class="p">):</span>
                <span class="k">break</span>

            <span class="n">block</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">change_indent</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>

        <span class="c1">#insert the rst prefix</span>
        <span class="n">sd</span> <span class="o">=</span> <span class="p">[</span><span class="n">Subst</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">,</span> <span class="s2">&quot;__codeprefix__&quot;</span><span class="p">)]</span>
        <span class="n">new_block</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">line</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s2">&quot;@subst(__codeprefix__)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">directives</span><span class="o">=</span><span class="n">sd</span><span class="p">),</span>
            <span class="n">line</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s2">&quot;::&quot;</span><span class="p">),</span>
            <span class="n">line</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="p">]</span>

        <span class="n">block</span><span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_block</span>
        <span class="n">block</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
<div class="section" id="edoc">
<h3>Edoc<a class="headerlink" href="#edoc" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="Edoc">
<em class="property">class </em><code class="descname">Edoc</code><a class="headerlink" href="#Edoc" title="Permalink to this definition">¶</a></dt>
<dd><p>This class represents an <code class="docutils literal"><span class="pre">&#64;edoc</span></code> directive. It inherits
<a class="reference internal" href="#Directive" title="Directive"><code class="xref py py-class docutils literal"><span class="pre">Directive</span></code></a>.</p>
<p>The <code class="docutils literal"><span class="pre">&#64;edoc</span></code> directive ends a previously started <code class="docutils literal"><span class="pre">&#64;code</span></code> directive</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Edoc</span><span class="p">(</span><span class="n">Directive</span><span class="p">):</span>
    <span class="n">expression</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;@edoc&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">del</span> <span class="n">block</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
<div class="section" id="if">
<h3>If<a class="headerlink" href="#if" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="If">
<em class="property">class </em><code class="descname">If</code><a class="headerlink" href="#If" title="Permalink to this definition">¶</a></dt>
<dd><p>This class represents an <code class="docutils literal"><span class="pre">&#64;if</span></code> directive. It inherits
<a class="reference internal" href="#NameDirective" title="NameDirective"><code class="xref py py-class docutils literal"><span class="pre">NameDirective</span></code></a>.</p>
<p>The <code class="docutils literal"><span class="pre">&#64;if</span></code> directive is used for conditional weaving.
The content of an <code class="docutils literal"><span class="pre">&#64;if</span></code>, <code class="docutils literal"><span class="pre">&#64;fi</span></code> block is waved if the
named token argument of <code class="docutils literal"><span class="pre">&#64;if</span></code>, is defined in the command line
by the <code class="docutils literal"><span class="pre">--token</span></code> option.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">If</span><span class="p">(</span><span class="n">NameDirective</span><span class="p">):</span>
    <span class="n">expression</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;@if\((.+)\)&quot;</span><span class="p">)</span>
    <span class="n">priority</span> <span class="o">=</span> <span class="mi">4</span>

    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">block</span><span class="p">)):</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">block</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">directive</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">Fi</span><span class="p">)</span> <span class="ow">and</span> <span class="n">d</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">document</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">,</span> <span class="s2">&quot;No fi for if </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">document</span><span class="o">.</span><span class="n">tokens</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">block</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">block</span><span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="n">j</span><span class="p">]</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
<div class="section" id="fi">
<h3>Fi<a class="headerlink" href="#fi" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="Fi">
<em class="property">class </em><code class="descname">Fi</code><a class="headerlink" href="#Fi" title="Permalink to this definition">¶</a></dt>
<dd><p>This class represents a <cite>&#64;fi</cite> directive. It inherits
<a class="reference internal" href="#NameDirective" title="NameDirective"><code class="xref py py-class docutils literal"><span class="pre">NameDirective</span></code></a>.</p>
<p>The <code class="docutils literal"><span class="pre">&#64;fi</span></code> ends an <code class="docutils literal"><span class="pre">&#64;if</span></code> directive</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Fi</span><span class="p">(</span><span class="n">NameDirective</span><span class="p">):</span>
    <span class="n">expression</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;@fi\((.+)\)&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">del</span> <span class="n">block</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
<div class="section" id="ignore">
<h3>Ignore<a class="headerlink" href="#ignore" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="Ignore">
<em class="property">class </em><code class="descname">Ignore</code><a class="headerlink" href="#Ignore" title="Permalink to this definition">¶</a></dt>
<dd><p>This class represents an <code class="docutils literal"><span class="pre">&#64;ignore</span></code> directive. It inherits
<a class="reference internal" href="#Directive" title="Directive"><code class="xref py py-class docutils literal"><span class="pre">Directive</span></code></a>.</p>
<p>The <code class="docutils literal"><span class="pre">&#64;ignore</span></code> directive ignores the line in the
documentation output. It can be used for commentaries.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Ignore</span><span class="p">(</span><span class="n">Directive</span><span class="p">):</span>
    <span class="n">expression</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;@ignore&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">del</span> <span class="n">block</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
<div class="section" id="define">
<h3>Define<a class="headerlink" href="#define" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="Define">
<em class="property">class </em><code class="descname">Define</code><a class="headerlink" href="#Define" title="Permalink to this definition">¶</a></dt>
<dd><p>This class represents an <code class="docutils literal"><span class="pre">&#64;define</span></code> directive. It inherits
<a class="reference internal" href="#NameDirective" title="NameDirective"><code class="xref py py-class docutils literal"><span class="pre">NameDirective</span></code></a>.</p>
<p>The <code class="docutils literal"><span class="pre">&#64;define</span></code> directive defines a macro, that can be used
with a <code class="docutils literal"><span class="pre">&#64;subst</span></code> directive. If a <code class="docutils literal"><span class="pre">substitution</span></code>
argument is given, the macro defines an inline substitution.
Otherwise the <code class="docutils literal"><span class="pre">&#64;define</span></code> has to be ended by an <code class="docutils literal"><span class="pre">&#64;enifed</span></code>
directive.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Define</span><span class="p">(</span><span class="n">NameDirective</span><span class="p">):</span>

    <span class="n">expression</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;@define\((.+)\)&quot;</span><span class="p">)</span>
    <span class="n">priority</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="c1">#more than one argument ==&gt; an inline substitution</span>
            <span class="n">document</span><span class="o">.</span><span class="n">macros</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="c1">#search for the matching @enifed</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">block</span><span class="p">)):</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">block</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">directive</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">Enifed</span><span class="p">)</span> <span class="ow">and</span> <span class="n">d</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">document</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">,</span> <span class="s2">&quot;No enifed for define </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">document</span><span class="o">.</span><span class="n">macros</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="n">l</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">block</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">j</span><span class="p">]</span> <span class="p">]</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
<div class="section" id="enifed">
<h3>Enifed<a class="headerlink" href="#enifed" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="Enifed">
<em class="property">class </em><code class="descname">Enifed</code><a class="headerlink" href="#Enifed" title="Permalink to this definition">¶</a></dt>
<dd><p>This class represents an <code class="docutils literal"><span class="pre">&#64;enifed</span></code> directive. It inherits
<a class="reference internal" href="#NameDirective" title="NameDirective"><code class="xref py py-class docutils literal"><span class="pre">NameDirective</span></code></a>.</p>
<p>The <code class="docutils literal"><span class="pre">&#64;enifed</span></code> directive ends a macro defined by the
<code class="docutils literal"><span class="pre">&#64;define</span></code> directive.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Enifed</span><span class="p">(</span><span class="n">NameDirective</span><span class="p">):</span>

    <span class="n">expression</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;@enifed\((.+)\)&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">del</span> <span class="n">block</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
<div class="section" id="subst">
<h3>Subst<a class="headerlink" href="#subst" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="Subst">
<em class="property">class </em><code class="descname">Subst</code><a class="headerlink" href="#Subst" title="Permalink to this definition">¶</a></dt>
<dd><p>This class represents a <code class="docutils literal"><span class="pre">&#64;subst</span></code> directive. It inherits
<a class="reference internal" href="#NameDirective" title="NameDirective"><code class="xref py py-class docutils literal"><span class="pre">NameDirective</span></code></a>.</p>
<p>The <code class="docutils literal"><span class="pre">&#64;subst</span></code> directive is replaced by the substitution,
defined by a <code class="docutils literal"><span class="pre">&#64;define</span></code> directive. There are two predefined
macros:</p>
<blockquote>
<div><dl class="docutils">
<dt><code class="docutils literal"><span class="pre">__line__</span></code></dt>
<dd>Define the current line within the source code. The
<code class="docutils literal"><span class="pre">&#64;subst</span></code> can also handle operation with <code class="docutils literal"><span class="pre">__line__</span></code>
like <code class="docutils literal"><span class="pre">__line__</span> <span class="pre">+</span> <span class="pre">2</span></code>.</dd>
<dt><code class="docutils literal"><span class="pre">__file__</span></code></dt>
<dd>Defines the current source file name.</dd>
</dl>
</div></blockquote>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Subst</span><span class="p">(</span><span class="n">NameDirective</span><span class="p">):</span>
    <span class="n">expression</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;@subst\((.+?)\)&quot;</span><span class="p">)</span>
    <span class="n">priority</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">block</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

        <span class="c1">#find the substitution</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;__line__&quot;</span><span class="p">):</span>
            <span class="n">expression</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__line__&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">subst</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">expression</span><span class="p">))</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">document</span><span class="o">.</span><span class="n">macros</span><span class="p">:</span>
            <span class="n">document</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">,</span> <span class="s2">&quot;No macro </span><span class="si">%s</span><span class="s2"> found&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">subst</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">macros</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subst</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1">#inline substitution</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
            <span class="n">l</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;@subst(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">subst</span><span class="p">)</span>
            <span class="n">block</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ln</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">index</span>
            <span class="n">block</span><span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="n">l</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="o">+</span><span class="n">j</span><span class="p">)</span>\
                                         <span class="o">.</span><span class="n">change_indent</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">indent</span><span class="p">)</span>\
                                         <span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">ln</span><span class="o">+</span><span class="n">j</span><span class="p">)</span>
                                     <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">subst</span><span class="p">)</span> <span class="p">]</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
<div class="section" id="indent">
<h3>Indent<a class="headerlink" href="#indent" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="Indent">
<em class="property">class </em><code class="descname">Indent</code><a class="headerlink" href="#Indent" title="Permalink to this definition">¶</a></dt>
<dd><p>This class represents an <code class="docutils literal"><span class="pre">&#64;indent</span></code> directive. It inherits
<a class="reference internal" href="#Directive" title="Directive"><code class="xref py py-class docutils literal"><span class="pre">Directive</span></code></a>.</p>
<p>The <code class="docutils literal"><span class="pre">&#64;indent</span></code> directive changes the indentation of the
following lines. For example a  call <code class="docutils literal"><span class="pre">&#64;indent</span> <span class="pre">-4</span></code>
dedents the following lines by 4 spaces.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Indent</span><span class="p">(</span><span class="n">Directive</span><span class="p">):</span>
    <span class="n">expression</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;@indent\s+([+-]?\d+)&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">mo</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Indent</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">mo</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indent</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mo</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span> <span class="n">l</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">change_indent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">)</span>
                  <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">block</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span> <span class="p">]</span>
        <span class="n">block</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span> <span class="o">=</span> <span class="n">lines</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
</div>
<div class="section" id="readers">
<h2>Readers<a class="headerlink" href="#readers" title="Permalink to this headline">¶</a></h2>
<p>Readers are responsible for the language dependent
source parsing.</p>
<div class="section" id="reader">
<h3>Reader<a class="headerlink" href="#reader" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="Reader">
<em class="property">class </em><code class="descname">Reader</code><span class="sig-paren">(</span><em>lexer</em><span class="sig-paren">)</span><a class="headerlink" href="#Reader" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the base class for all readers. The public functions
exposed to <a class="reference internal" href="#Document" title="Document"><code class="xref py py-class docutils literal"><span class="pre">Document</span></code></a> are <a class="reference internal" href="#Reader.process" title="Reader.process"><code class="xref py py-meth docutils literal"><span class="pre">process()</span></code></a>,
and <a class="reference internal" href="#Reader.filter_output" title="Reader.filter_output"><code class="xref py py-meth docutils literal"><span class="pre">filter_output()</span></code></a>.</p>
<p>The main tasks for a reader is:</p>
<blockquote>
<div><ul class="simple">
<li>Recognize lines that can contain directives. (comment lines or doc strings).</li>
<li>Modify the source for language specific optimizations.</li>
<li>Filter the processed output.</li>
</ul>
</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>lexer</strong> &#8211; A pygments lexer for the specified language</td>
</tr>
</tbody>
</table>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">re_line_start</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;^&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="p">)</span> <span class="c1">#to find the line start indices</span>


<span class="k">class</span> <span class="nc">Reader</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="c1">#Public Methods</span>
    <span class="o">&lt;&lt;</span><span class="n">Reader</span><span class="o">.</span><span class="n">__init__</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Reader</span><span class="o">.</span><span class="n">process</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Reader</span><span class="o">.</span><span class="n">filter_output</span><span class="o">&gt;&gt;</span>

    <span class="c1">#Protected Methods</span>
    <span class="o">&lt;&lt;</span><span class="n">Reader</span><span class="o">.</span><span class="n">_accept_token</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Reader</span><span class="o">.</span><span class="n">_post_process</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Reader</span><span class="o">.</span><span class="n">_handle_token</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Reader</span><span class="o">.</span><span class="n">_cut_comment</span><span class="o">&gt;&gt;</span>
</pre></div>
</td></tr></table></div>
<dl class="method">
<dt id="Reader.__init__">
<code class="descname">__init__</code><span class="sig-paren">(</span><em>lexer</em>, <em>single_comment_markers</em>, <em>block_comment_markers</em><span class="sig-paren">)</span><a class="headerlink" href="#Reader.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>The constructor initialises the language specific pygments lexer and comment markers.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>lexer</strong> (<em>Lexer</em>) &#8211; The language specific pygments lexer.</li>
<li><strong>single_comment_markers</strong> (<em>string[]</em>) &#8211; The language specific single comment markers.</li>
<li><strong>block_comment_markers</strong> (<em>string[]</em>) &#8211; The language specific block comment markers.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lexer</span><span class="p">,</span> <span class="n">single_comment_markers</span><span class="p">,</span> <span class="n">block_comment_markers</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lexer</span> <span class="o">=</span> <span class="n">lexer</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">single_comment_markers</span> <span class="o">=</span> <span class="n">single_comment_markers</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">block_comment_markers</span> <span class="o">=</span> <span class="n">block_comment_markers</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

<dl class="method">
<dt id="Reader.process">
<code class="descname">process</code><span class="sig-paren">(</span><em>fname</em>, <em>text</em><span class="sig-paren">)</span><a class="headerlink" href="#Reader.process" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads the source code and identifies the directives.
This method is call by <a class="reference internal" href="#Document" title="Document"><code class="xref py py-class docutils literal"><span class="pre">Document</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>fname</strong> (<a class="reference external" href="https://docs.python.org/2/library/string.html#module-string" title="(in Python v2.7)"><em>string</em></a>) &#8211; The file name of the source code</li>
<li><strong>text</strong> (<a class="reference external" href="https://docs.python.org/2/library/string.html#module-string" title="(in Python v2.7)"><em>string</em></a>) &#8211; The source code</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A list of <a class="reference internal" href="#Line" title="Line"><code class="xref py py-class docutils literal"><span class="pre">Line</span></code></a> objects.</p>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">starts</span> <span class="o">=</span> <span class="p">[</span> <span class="n">mo</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="k">for</span> <span class="n">mo</span> <span class="ow">in</span> <span class="n">re_line_start</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="p">]</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span> <span class="n">Line</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">())</span> <span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="n">lines</span>    <span class="c1"># A list of lines</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">starts</span> <span class="o">=</span> <span class="n">starts</span>  <span class="c1"># the start indices of the lines</span>

    <span class="n">tokens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">get_tokens_unprocessed</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_token</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_post_process</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

<dl class="method">
<dt id="Reader.filter_output">
<code class="descname">filter_output</code><span class="sig-paren">(</span><em>lines</em><span class="sig-paren">)</span><a class="headerlink" href="#Reader.filter_output" title="Permalink to this definition">¶</a></dt>
<dd><p>This method is call by <a class="reference internal" href="#Document" title="Document"><code class="xref py py-class docutils literal"><span class="pre">Document</span></code></a> and gives
the reader the chance to influence the final output.</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">filter_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">lines</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Reader._handle_token">
<code class="descname">_handle_token</code><span class="sig-paren">(</span><em>index</em>, <em>token</em>, <em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#Reader._handle_token" title="Permalink to this definition">¶</a></dt>
<dd><p>Find antiweb directives in valid pygments tokens.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>index</strong> (<em>integer</em>) &#8211; The index within the source code</li>
<li><strong>token</strong> &#8211; A pygments token.</li>
<li><strong>value</strong> (<a class="reference external" href="https://docs.python.org/2/library/string.html#module-string" title="(in Python v2.7)"><em>string</em></a>) &#8211; The token value.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_handle_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_accept_token</span><span class="p">(</span><span class="n">token</span><span class="p">):</span> <span class="k">return</span>
    <span class="n">cvalue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cut_comment</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">cvalue</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">directives</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="k">for</span> <span class="n">mo</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">cvalue</span><span class="p">):</span>
            <span class="n">li</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">starts</span><span class="p">,</span> <span class="n">index</span><span class="o">+</span><span class="n">mo</span><span class="o">.</span><span class="n">start</span><span class="p">()</span><span class="o">+</span><span class="n">offset</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="n">li</span><span class="p">]</span>
            <span class="n">line</span><span class="o">.</span><span class="n">directives</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">directives</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span> <span class="n">v</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">mo</span><span class="p">)</span> <span class="p">]</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

<dl class="method">
<dt id="Reader._cut_comment">
<code class="descname">_cut_comment</code><span class="sig-paren">(</span><em>index</em>, <em>token</em>, <em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#Reader._cut_comment" title="Permalink to this definition">¶</a></dt>
<dd><p>Cuts of the comment identifiers.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>index</strong> (<em>integer</em>) &#8211; The index within the source code</li>
<li><strong>token</strong> &#8211; A pygments token.</li>
<li><strong>value</strong> (<a class="reference external" href="https://docs.python.org/2/library/string.html#module-string" title="(in Python v2.7)"><em>string</em></a>) &#8211; The token value.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">value without comment identifiers.</p>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_cut_comment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">text</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Reader._post_process">
<code class="descname">_post_process</code><span class="sig-paren">(</span><em>fname</em>, <em>text</em><span class="sig-paren">)</span><a class="headerlink" href="#Reader._post_process" title="Permalink to this definition">¶</a></dt>
<dd><p>Does some post processing after the directives where found.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_post_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>

    <span class="c1">#correct the line attribute of directives, in case there have</span>
    <span class="c1">#been lines inserted or deleted by subclasses of Reader</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">l</span><span class="o">.</span><span class="n">directives</span><span class="p">:</span>
            <span class="n">d</span><span class="o">.</span><span class="n">line</span> <span class="o">=</span> <span class="n">i</span>

    <span class="c1">#give the directives the chance to match</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">l</span><span class="o">.</span><span class="n">directives</span><span class="p">:</span>
            <span class="n">d</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

<dl class="method">
<dt id="Reader._accept_token">
<code class="descname">_accept_token</code><span class="sig-paren">(</span><em>token</em><span class="sig-paren">)</span><a class="headerlink" href="#Reader._accept_token" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks if the token type may contain a directive.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>token</strong> &#8211; A pygments token</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><code class="docutils literal"><span class="pre">True</span></code> if the token may contain a directive.
<code class="docutils literal"><span class="pre">False</span></code> otherwise.</td>
</tr>
</tbody>
</table>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_accept_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
    <span class="k">return</span> <span class="kc">True</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="creader">
<h3>CReader<a class="headerlink" href="#creader" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="CReader">
<em class="property">class </em><code class="descname">CReader</code><a class="headerlink" href="#CReader" title="Permalink to this definition">¶</a></dt>
<dd><p>A reader for C/C++ code. This class inherits <a class="reference internal" href="#Reader" title="Reader"><code class="xref py py-class docutils literal"><span class="pre">Reader</span></code></a>.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CReader</span><span class="p">(</span><span class="n">Reader</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lexer</span><span class="p">,</span>  <span class="n">single_comment_markers</span><span class="p">,</span>  <span class="n">block_comment_markers</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CReader</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">lexer</span><span class="p">,</span>  <span class="n">single_comment_markers</span><span class="p">,</span>  <span class="n">block_comment_markers</span><span class="p">)</span>
        <span class="c1">#For C/C++ exists only one type of single and block comment markers.</span>
        <span class="c1">#The markers are retrieved here in order to avoid iterating over the markers every time they are used.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">single_comment_marker</span> <span class="o">=</span> <span class="n">single_comment_markers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block_comment_marker_start</span> <span class="o">=</span> <span class="n">block_comment_markers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block_comment_marker_end</span> <span class="o">=</span> <span class="n">block_comment_markers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_accept_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">Token</span><span class="o">.</span><span class="n">Comment</span>

    <span class="k">def</span> <span class="nf">_cut_comment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block_comment_marker_start</span><span class="p">):</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">text</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">single_comment_marker</span><span class="p">):</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>

        <span class="k">return</span> <span class="n">text</span>

    <span class="k">def</span> <span class="nf">filter_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        .. py:method:: filter_output(lines)</span>

<span class="sd">           See :py:meth:`Reader.filter_output`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;d&quot;</span><span class="p">:</span>
                <span class="c1">#remove comment chars in document lines</span>
                <span class="n">stext</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">stext</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_comment_marker_start</span> <span class="ow">or</span> <span class="n">stext</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_comment_marker_end</span><span class="p">:</span>
                    <span class="c1">#remove /* and */ from documentation lines</span>
                    <span class="c1">#see the l.text.lstrip()! if the lines ends with a white space</span>
                    <span class="c1">#the quotes will be kept! This is feature, to force the quotes</span>
                    <span class="c1">#in the output</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">stext</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">single_comment_marker</span><span class="p">):</span>
                    <span class="n">l</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">indented</span><span class="p">(</span><span class="n">stext</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>

            <span class="k">yield</span> <span class="n">l</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
<div class="section" id="csharpreader">
<h3>CSharpReader<a class="headerlink" href="#csharpreader" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="CSharpReader">
<em class="property">class </em><code class="descname">CSharpReader</code><a class="headerlink" href="#CSharpReader" title="Permalink to this definition">¶</a></dt>
<dd><p>A reader for C# code. This class inherits <a class="reference internal" href="#CReader" title="CReader"><code class="xref py py-class docutils literal"><span class="pre">CReader</span></code></a>.
The CSharpReader is needed because C# specific output filtering is applied.
Compared to C, C# uses XML comments starting with <em>///</em> which are reused
for the final documentation. Here you can see an overview of the CSharpReader class
and its methods.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CSharpReader</span><span class="p">(</span><span class="n">CReader</span><span class="p">):</span>

    <span class="n">default_xml_block_index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lexer</span><span class="p">,</span>  <span class="n">single_comment_markers</span><span class="p">,</span>  <span class="n">block_comment_markers</span><span class="p">):</span>
        <span class="c1">#the call to the base class CReader is needed for initialising the comment markers</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CSharpReader</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">lexer</span><span class="p">,</span>  <span class="n">single_comment_markers</span><span class="p">,</span>  <span class="n">block_comment_markers</span><span class="p">)</span>

    <span class="o">&lt;&lt;</span><span class="n">CSharpReader</span><span class="o">.</span><span class="n">strip_tags</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">CSharpReader</span><span class="o">.</span><span class="n">get_attribute_text</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">CSharpReader</span><span class="o">.</span><span class="n">get_stripped_xml_lines</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">CSharpReader</span><span class="o">.</span><span class="n">create_new_lines</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">CSharpReader</span><span class="o">.</span><span class="n">init_xml_block</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">CSharpReader</span><span class="o">.</span><span class="n">filter_output</span><span class="o">&gt;&gt;</span>
</pre></div>
</td></tr></table></div>
<dl class="method">
<dt id="CSharpReader.strip_tags">
<code class="descname">strip_tags</code><span class="sig-paren">(</span><em>tags</em><span class="sig-paren">)</span><a class="headerlink" href="#CSharpReader.strip_tags" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes all C# XML tags. The tags are replaced by their attributes and contents.
This method is called recursively. This is needed if the content of a tag also contains
tags.</p>
<p>Examples:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">&lt;param</span> <span class="pre">name=&quot;arg1&quot;&gt;value&lt;/param&gt;</span></code> will be stripped to : <em>&#8220;arg1 value&#8221;</em></li>
<li><code class="docutils literal"><span class="pre">&lt;para&gt;Start</span> <span class="pre">&lt;see</span> <span class="pre">cref=&quot;(String)&quot;/&gt;</span> <span class="pre">end&lt;/para&gt;</span></code> will be stripped to : <em>&#8220;Start (String) end&#8221;</em></li>
</ul>
</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>tags</strong> (<em>Tag</em>) &#8211; The parsed xml tags.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">the XML tags replaced by their attributes and contents.</td>
</tr>
</tbody>
</table>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">strip_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">tags</span><span class="p">):</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tags</span><span class="p">,</span>  <span class="n">Tag</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">tags</span><span class="o">.</span><span class="n">contents</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute_text</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attribute_text</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>

        <span class="c1">#if the content is a Navigablestring the content is simply concatenated</span>
        <span class="c1">#otherwise the contents of the content are recursively checked for xml tags</span>
        <span class="k">for</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">tag</span><span class="o">.</span><span class="n">contents</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">NavigableString</span><span class="p">):</span>
                <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strip_tags</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="n">content</span>

        <span class="n">tag</span><span class="o">.</span><span class="n">replaceWith</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">tags</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

<dl class="method">
<dt id="CSharpReader.get_attribute_text">
<code class="descname">get_attribute_text</code><span class="sig-paren">(</span><em>tag</em><span class="sig-paren">)</span><a class="headerlink" href="#CSharpReader.get_attribute_text" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the values of all XML tag attributes seperated by whitespace.</p>
<p>Examples:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">&lt;param</span> <span class="pre">name=&quot;arg1&quot;&gt;parameterValue&lt;/param&gt;</span></code> returns : <em>&#8220;arg1 &#8220;</em></li>
<li><code class="docutils literal"><span class="pre">&lt;include</span> <span class="pre">file='file1'</span> <span class="pre">path='[&#64;name=&quot;test&quot;]/*'</span> <span class="pre">/&gt;</span></code> returns: <em>&#8220;file1 [&#64;name=&#8221;test&#8221;]/</em> &#8220;*</li>
</ul>
</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>tag</strong> (<em>Tag</em>) &#8211; A BeautifulSoup Tag.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">the values of all attributes concatenated</td>
</tr>
</tbody>
</table>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_attribute_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">tag</span><span class="p">):</span>
    <span class="c1">#collect all values of xml tag attributes</span>
    <span class="n">attributes</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">attrs</span>
    <span class="n">attribute_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">attribute_text</span> <span class="o">=</span> <span class="n">value</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
    <span class="k">return</span> <span class="n">attribute_text</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

<dl class="method">
<dt id="CSharpReader.get_stripped_xml_lines">
<code class="descname">get_stripped_xml_lines</code><span class="sig-paren">(</span><em>xml_lines_block</em><span class="sig-paren">)</span><a class="headerlink" href="#CSharpReader.get_stripped_xml_lines" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes all XML comment tags from the lines in the xml_lines_block.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>xml_lines_block</strong> (<em>Line[]</em>) &#8211; A list containing all Line object which belong to an XML comment block.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">A list of all stripped XML lines.</td>
</tr>
</tbody>
</table>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_stripped_xml_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">xml_lines_block</span><span class="p">):</span>
    <span class="c1">#the xml_lines_block contains Line objects. As the xml parser expects a string</span>
    <span class="c1">#the Line obects have to be converted to a string.</span>
    <span class="n">xml_text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">attrgetter</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">),</span> <span class="n">xml_lines_block</span><span class="p">))</span>

    <span class="c1">#the xml lines will be parsed and then all xml tags will be removed</span>
    <span class="n">xml_tags</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">xml_text</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">strip_tags</span><span class="p">(</span><span class="n">xml_tags</span><span class="p">)</span>
    <span class="n">stripped_xml_lines</span> <span class="o">=</span> <span class="n">xml_tags</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">stripped_xml_lines</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

<dl class="method">
<dt id="CSharpReader.create_new_lines">
<code class="descname">create_new_lines</code><span class="sig-paren">(</span><em>stripped_xml_lines</em>, <em>index</em>, <em>initial_line</em><span class="sig-paren">)</span><a class="headerlink" href="#CSharpReader.create_new_lines" title="Permalink to this definition">¶</a></dt>
<dd><p>This method is called after all XML comment tags are stripped. For each new
line in the stripped_xml_lines a new Line object is created.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>stripped_xml_lines</strong> (<em>string[]</em>) &#8211; The comment lines were the XML tags have been stripped.</li>
<li><strong>index</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) &#8211; The starting index for the new line object.</li>
<li><strong>initial_line</strong> (<a class="reference internal" href="#Line" title="Line"><em>Line</em></a>) &#8211; The first line of the xml comment block. Its indentation will be used for all new created lines.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A generator containing the lines which have been created out of the stripped_xml_lines.</p>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_new_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stripped_xml_lines</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">initial_line</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">stripped_xml_lines</span><span class="p">:</span>
        <span class="n">new_line</span> <span class="o">=</span> <span class="n">Line</span><span class="p">(</span><span class="n">initial_line</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span>  <span class="n">index</span><span class="p">,</span>  <span class="n">initial_line</span><span class="o">.</span><span class="n">indented</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()))</span>
        <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">yield</span> <span class="n">new_line</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

<dl class="method">
<dt id="CSharpReader.init_xml_block">
<code class="descname">init_xml_block</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#CSharpReader.init_xml_block" title="Permalink to this definition">¶</a></dt>
<dd><p>Inits the variables which are needed for collecting an XML comment block.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">init_xml_block</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">xml_lines_block</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">xml_start_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_xml_block_index</span>
    <span class="k">return</span> <span class="n">xml_lines_block</span><span class="p">,</span>  <span class="n">xml_start_index</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

<dl class="method">
<dt id="CSharpReader.filter_output">
<code class="descname">filter_output</code><span class="sig-paren">(</span><em>lines</em><span class="sig-paren">)</span><a class="headerlink" href="#CSharpReader.filter_output" title="Permalink to this definition">¶</a></dt>
<dd><p>Applies C# specific filtering for the final output.
XML comment tags are replaced by their attributes and contents.</p>
<p>See <a class="reference internal" href="#Reader.filter_output" title="Reader.filter_output"><code class="xref py py-meth docutils literal"><span class="pre">Reader.filter_output()</span></code></a></p>
<dl class="docutils">
<dt>We have to handle four cases:</dt>
<dd><ol class="first last arabic simple">
<li>The current line is a code line: The line is added to result.</li>
<li>The current line is a block comment: The line can be skipped.</li>
<li>The current line is an XML comment: The line is added to the xml_lines_block.</li>
<li>The current line is a single comment line: Add the line to result. If the current line is the first
line after an xml comment block, the comment block is processed and its lines are added to result.</li>
</ol>
</dd>
</dl>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>lines</strong> (<em>Line[]</em>) &#8211; All lines of a file. The directives have already been replaced.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">A generator containing all lines for the final output.</td>
</tr>
</tbody>
</table>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">filter_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
    <span class="c1">#first the CReader filters the output</span>
    <span class="c1">#afterwards the CSharpReader does some C# specific filtering</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">CSharpReader</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">filter_output</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="c1">#the xml_lines_block collects xml comment lines</span>
    <span class="c1">#if the end of an xml comment block is identified, the collected xml lines are processed</span>
    <span class="n">xml_lines_block</span><span class="p">,</span> <span class="n">xml_start_index</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_xml_block</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;d&quot;</span><span class="p">:</span>
            <span class="c1">#remove comment chars in document lines</span>
            <span class="n">stext</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">stext</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_comment_marker_start</span> <span class="ow">or</span> <span class="n">stext</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_comment_marker_end</span><span class="p">:</span>
                <span class="c1">#remove /* and */ from documentation lines. see the l.text.lstrip()!</span>
                <span class="c1">#if the lines ends with a white space the quotes will be kept!</span>
                <span class="c1">#This is feature, to force the quotes in the output</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">stext</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">stext</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block_comment_marker_start</span><span class="p">):</span>
                <span class="n">l</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">indented</span><span class="p">(</span><span class="n">stext</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

                <span class="k">if</span><span class="p">(</span><span class="n">xml_start_index</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_xml_block_index</span><span class="p">):</span>
                    <span class="c1">#indicates that a new xml_block has started</span>
                    <span class="n">xml_start_index</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">index</span>

                <span class="n">xml_lines_block</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">xml_start_index</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_xml_block_index</span><span class="p">:</span>
                <span class="c1">#an xml comment block has ended, now the block is processed</span>
                <span class="c1">#at first the xml tags are stripped, afterwards a new line object is created for each</span>
                <span class="c1">#stripped line and added to the final result generator</span>
                <span class="n">stripped_xml_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stripped_xml_lines</span><span class="p">(</span><span class="n">xml_lines_block</span><span class="p">)</span>

                <span class="n">new_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_new_lines</span><span class="p">(</span><span class="n">stripped_xml_lines</span><span class="p">,</span> <span class="n">xml_start_index</span><span class="p">,</span> <span class="n">xml_lines_block</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">new_lines</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">line</span>

                <span class="c1">#reset the xml variables for the next block</span>
                <span class="n">xml_lines_block</span><span class="p">,</span> <span class="n">xml_start_index</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_xml_block</span><span class="p">()</span>

        <span class="k">yield</span> <span class="n">l</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="pythonreader">
<h3>PythonReader<a class="headerlink" href="#pythonreader" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="PythonReader">
<em class="property">class </em><code class="descname">PythonReader</code><a class="headerlink" href="#PythonReader" title="Permalink to this definition">¶</a></dt>
<dd><p>A reader for python code. This class inherits <a class="reference internal" href="#Reader" title="Reader"><code class="xref py py-class docutils literal"><span class="pre">Reader</span></code></a>.
To reduce the number of sentinels, the python reader does some more
sophisticated source parsing:</p>
<p>A construction like:</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@cstart</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Foo&#39;s documentation</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="n">code</span>
</pre></div>
</td></tr></table></div>
<p>is replaced by:</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@cstart</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">):</span>
   <span class="nd">@start</span><span class="p">(</span><span class="n">foo</span> <span class="n">doc</span><span class="p">)</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Foo&#39;s documentation</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="nd">@include</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
   <span class="o">@</span><span class="p">(</span><span class="n">foo</span> <span class="n">doc</span><span class="p">)</span>
   <span class="n">code</span>
</pre></div>
</td></tr></table></div>
<p>The replacement will be done only:</p>
<blockquote>
<div><ul class="simple">
<li>If the doc string begins with &#8220;&#8221;&#8220;</li>
<li>If the block was started by a <code class="docutils literal"><span class="pre">&#64;rstart</span></code> or <code class="docutils literal"><span class="pre">&#64;cstart</span></code> directive</li>
<li>If there is no antiweb directive in the doc string.</li>
<li>Only a <code class="docutils literal"><span class="pre">&#64;cstart</span></code> will insert the &#64;include directive.</li>
</ul>
</div></blockquote>
<p>Additionally the python reader removes all single line <code class="docutils literal"><span class="pre">&quot;&quot;&quot;</span></code> and <code class="docutils literal"><span class="pre">'''</span></code>
from documentation lines. In the following lines:</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@start</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Documentation</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</td></tr></table></div>
<p>The <code class="docutils literal"><span class="pre">&quot;&quot;&quot;</span></code> are automatically removed in the rst output. (see <a class="reference internal" href="#PythonReader.filter_output" title="PythonReader.filter_output"><code class="xref py py-meth docutils literal"><span class="pre">filter_output()</span></code></a>
for details).</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PythonReader</span><span class="p">(</span><span class="n">Reader</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lexer</span><span class="p">,</span>  <span class="n">single_comment_markers</span><span class="p">,</span>  <span class="n">block_comment_markers</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PythonReader</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">lexer</span><span class="p">,</span>  <span class="n">single_comment_markers</span><span class="p">,</span>  <span class="n">block_comment_markers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc_lines</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="o">&lt;&lt;</span><span class="n">PythonReader</span><span class="o">.</span><span class="n">_post_process</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">PythonReader</span><span class="o">.</span><span class="n">_accept_token</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">PythonReader</span><span class="o">.</span><span class="n">_cut_comment</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">PythonReader</span><span class="o">.</span><span class="n">filter_output</span><span class="o">&gt;&gt;</span>
<span class="c1"># The keys are the lexer names of pygments</span>
<span class="n">readers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;C&quot;</span> <span class="p">:</span> <span class="n">CReader</span><span class="p">,</span>
    <span class="s2">&quot;C++&quot;</span> <span class="p">:</span> <span class="n">CReader</span><span class="p">,</span>
    <span class="s2">&quot;C#&quot;</span> <span class="p">:</span> <span class="n">CSharpReader</span><span class="p">,</span>
    <span class="s2">&quot;Python&quot;</span> <span class="p">:</span> <span class="n">PythonReader</span><span class="p">,</span>
    <span class="s2">&quot;Clojure&quot;</span> <span class="p">:</span> <span class="n">ClojureReader</span><span class="p">,</span>
    <span class="s2">&quot;rst&quot;</span> <span class="p">:</span> <span class="n">CReader</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<dl class="method">
<dt id="PythonReader._post_process">
<code class="descname">_post_process</code><span class="sig-paren">(</span><em>fname</em>, <em>text</em><span class="sig-paren">)</span><a class="headerlink" href="#PythonReader._post_process" title="Permalink to this definition">¶</a></dt>
<dd><p>See <a class="reference internal" href="#Reader._post_process" title="Reader._post_process"><code class="xref py py-meth docutils literal"><span class="pre">Reader._post_process()</span></code></a>.</p>
<p>This implementation <em>decorates</em> doc strings
with antiweb directives.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_post_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="c1">#from behind because we will probably insert some lines</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">doc_lines</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1">#handle each found doc string</span>
    <span class="k">for</span> <span class="n">start_line</span><span class="p">,</span> <span class="n">end_line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc_lines</span><span class="p">:</span>
        <span class="n">indents</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="o">&lt;&lt;</span><span class="n">no</span> <span class="n">antiweb</span> <span class="n">directives</span> <span class="ow">in</span> <span class="n">doc</span> <span class="n">string</span><span class="o">&gt;&gt;</span>
        <span class="o">&lt;&lt;</span><span class="n">find</span> <span class="n">the</span> <span class="n">last</span> <span class="n">directive</span> <span class="n">before</span> <span class="n">the</span> <span class="n">doc</span> <span class="n">string</span><span class="o">&gt;&gt;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">last_directive</span><span class="p">,</span> <span class="n">RStart</span><span class="p">):</span>
            <span class="o">&lt;&lt;</span><span class="n">decorate</span> <span class="n">beginning</span> <span class="ow">and</span> <span class="n">end</span><span class="o">&gt;&gt;</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">last_directive</span><span class="p">,</span> <span class="n">CStart</span><span class="p">):</span>
                <span class="o">&lt;&lt;</span><span class="n">insert</span> <span class="n">additional</span> <span class="n">include</span><span class="o">&gt;&gt;</span>

    <span class="nb">super</span><span class="p">(</span><span class="n">PythonReader</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_post_process</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p id="no-antiweb-directives-in-doc-string"><strong>&lt;&lt;no antiweb directives in doc string&gt;&gt;</strong></p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#If antiweb directives are within the doc string,</span>
<span class="c1">#the doc string will not be decorated!</span>
<span class="n">directives_between_start_and_end_line</span> <span class="o">=</span> <span class="kc">False</span>
<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="n">start_line</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">end_line</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">l</span><span class="p">:</span>
        <span class="c1">#needed for &lt;&lt;insert additional include&gt;&gt;</span>
        <span class="n">indents</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">indent</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">directives</span><span class="p">:</span>
        <span class="n">directives_between_start_and_end_line</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">break</span>

<span class="k">if</span> <span class="n">directives_between_start_and_end_line</span><span class="p">:</span> <span class="k">continue</span>
</pre></div>
</td></tr></table></div>
<p id="find-the-last-directive-before-the-doc-string"><strong>&lt;&lt;find the last directive before the doc string&gt;&gt;</strong></p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">last_directive</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[:</span><span class="n">start_line</span><span class="p">]):</span>
    <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">directives</span><span class="p">:</span>
        <span class="n">last_directive</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">directives</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">break</span>
</pre></div>
</td></tr></table></div>
<p id="decorate-beginning-and-end"><strong>&lt;&lt;decorate beginning and end&gt;&gt;</strong></p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="n">start_line</span><span class="p">]</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">Start</span><span class="p">(</span><span class="n">start_line</span><span class="p">,</span> <span class="n">last_directive</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; doc&quot;</span><span class="p">)</span>
<span class="n">l</span><span class="o">.</span><span class="n">directives</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">directives</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">start</span><span class="p">]</span>

<span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="n">end_line</span><span class="p">]</span>
<span class="n">end</span> <span class="o">=</span> <span class="n">End</span><span class="p">(</span><span class="n">end_line</span><span class="p">,</span> <span class="n">last_directive</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; doc&quot;</span><span class="p">)</span>
<span class="n">l</span><span class="o">.</span><span class="n">directives</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">directives</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">end</span><span class="p">]</span>
</pre></div>
</td></tr></table></div>
<p id="insert-additional-include"><strong>&lt;&lt;insert additional include&gt;&gt;</strong></p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">l</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">include</span> <span class="o">=</span> <span class="n">Include</span><span class="p">(</span><span class="n">end_line</span><span class="p">,</span> <span class="n">last_directive</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="n">l</span><span class="o">.</span><span class="n">directives</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">directives</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">include</span><span class="p">]</span>
<span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">end_line</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>

<span class="c1">#the include directive should have the same</span>
<span class="c1">#indentation as the .. py:function:: directive</span>
<span class="c1">#inside the doc string. (It should be second</span>
<span class="c1">#value of sorted indents)</span>
<span class="n">indents</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">indents</span><span class="p">))</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indents</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">l</span><span class="o">.</span><span class="n">change_indent</span><span class="p">(</span><span class="n">indents</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">l</span><span class="o">.</span><span class="n">indent</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

<dl class="method">
<dt id="PythonReader._accept_token">
<code class="descname">_accept_token</code><span class="sig-paren">(</span><em>token</em><span class="sig-paren">)</span><a class="headerlink" href="#PythonReader._accept_token" title="Permalink to this definition">¶</a></dt>
<dd><p>See <a class="reference internal" href="#Reader._accept_token" title="Reader._accept_token"><code class="xref py py-meth docutils literal"><span class="pre">Reader._accept_token()</span></code></a>.</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_accept_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">Token</span><span class="o">.</span><span class="n">Comment</span> <span class="ow">or</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">Token</span><span class="o">.</span><span class="n">Literal</span><span class="o">.</span><span class="n">String</span><span class="o">.</span><span class="n">Doc</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="PythonReader.filter_output">
<code class="descname">filter_output</code><span class="sig-paren">(</span><em>lines</em><span class="sig-paren">)</span><a class="headerlink" href="#PythonReader.filter_output" title="Permalink to this definition">¶</a></dt>
<dd><p>See <a class="reference internal" href="#Reader.filter_output" title="Reader.filter_output"><code class="xref py py-meth docutils literal"><span class="pre">Reader.filter_output()</span></code></a>.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">filter_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;d&quot;</span><span class="p">:</span>
            <span class="c1">#remove comment chars in document lines</span>
            <span class="n">stext</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">stext</span> <span class="o">==</span> <span class="s1">&#39;&quot;&quot;&quot;&#39;</span> <span class="ow">or</span> <span class="n">stext</span> <span class="o">==</span> <span class="s2">&quot;&#39;&#39;&#39;&quot;</span><span class="p">:</span>
                <span class="c1">#remove &quot;&quot;&quot; and &#39;&#39;&#39; from documentation lines</span>
                <span class="c1">#see the l.text.lstrip()! if the lines ends with a white space</span>
                <span class="c1">#the quotes will be kept! This is feature, to force the quotes</span>
                <span class="c1">#in the output</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">stext</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">):</span>
                <span class="c1">#remove comments but not chapters</span>
                <span class="n">l</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">indented</span><span class="p">(</span><span class="n">stext</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

        <span class="k">yield</span> <span class="n">l</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

<dl class="method">
<dt id="PythonReader._cut_comment">
<code class="descname">_cut_comment</code><span class="sig-paren">(</span><em>index</em>, <em>token</em>, <em>text</em><span class="sig-paren">)</span><a class="headerlink" href="#PythonReader._cut_comment" title="Permalink to this definition">¶</a></dt>
<dd><p>See <a class="reference internal" href="#Reader._cut_comment" title="Reader._cut_comment"><code class="xref py py-meth docutils literal"><span class="pre">Reader._cut_comment()</span></code></a>.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_cut_comment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">Token</span><span class="o">.</span><span class="n">Literal</span><span class="o">.</span><span class="n">String</span><span class="o">.</span><span class="n">Doc</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&quot;&#39;</span><span class="p">):</span>
            <span class="c1">#save the start/end line of doc strings beginning with &quot;&quot;&quot;</span>
            <span class="c1">#for further decoration processing in _post_process,</span>
            <span class="n">start_line</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">starts</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
            <span class="n">end_line</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">starts</span><span class="p">,</span> <span class="n">index</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="n">text</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()))</span> <span class="c1">#filter out empty strings</span>
            <span class="k">if</span> <span class="n">lines</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">doc_lines</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start_line</span><span class="p">,</span> <span class="n">end_line</span><span class="p">))</span>

        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">text</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="clojurereader">
<h3>ClojureReader<a class="headerlink" href="#clojurereader" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="ClojureReader">
<em class="property">class </em><code class="descname">ClojureReader</code><a class="headerlink" href="#ClojureReader" title="Permalink to this definition">¶</a></dt>
<dd><p>A reader for Clojure code. This class inherits <a class="reference internal" href="#Reader" title="Reader"><code class="xref py py-class docutils literal"><span class="pre">Reader</span></code></a>.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ClojureReader</span><span class="p">(</span><span class="n">Reader</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_accept_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">Token</span><span class="o">.</span><span class="n">Comment</span>

    <span class="k">def</span> <span class="nf">_cut_comment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">):</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">return</span> <span class="n">text</span>

    <span class="k">def</span> <span class="nf">filter_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        .. py:method:: filter_output(lines)</span>

<span class="sd">           See :py:meth:`Reader.filter_output`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;d&quot;</span><span class="p">:</span>
                <span class="c1">#remove comment chars in document lines</span>
                <span class="n">stext</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">stext</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">):</span>
                    <span class="c1">#remove comments but not chapters</span>
                    <span class="n">l</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">indented</span><span class="p">(</span><span class="n">stext</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

        <span class="k">yield</span> <span class="n">l</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
<div class="section" id="genericreader">
<h3>GenericReader<a class="headerlink" href="#genericreader" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="GenericReader">
<em class="property">class </em><code class="descname">GenericReader</code><a class="headerlink" href="#GenericReader" title="Permalink to this definition">¶</a></dt>
<dd><p>A generic reader for languages with single line and block comments .
This class inherits <a class="reference internal" href="#Reader" title="Reader"><code class="xref py py-class docutils literal"><span class="pre">Reader</span></code></a>.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">GenericReader</span><span class="p">(</span><span class="n">Reader</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">single_comment_markers</span><span class="p">,</span> <span class="n">block_comment_markers</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">single_comment_markers</span> <span class="o">=</span> <span class="n">single_comment_markers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block_comment_markers</span> <span class="o">=</span> <span class="n">block_comment_markers</span>

    <span class="k">def</span> <span class="nf">_accept_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">Token</span><span class="o">.</span><span class="n">Comment</span>

    <span class="k">def</span> <span class="nf">_cut_comment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;/*&quot;</span><span class="p">):</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">text</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;//&quot;</span><span class="p">):</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>

        <span class="k">return</span> <span class="n">text</span>

    <span class="k">def</span> <span class="nf">filter_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;d&quot;</span><span class="p">:</span>
                <span class="c1">#remove comment chars in document lines</span>
                <span class="n">stext</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">block_start</span><span class="p">,</span> <span class="n">block_end</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_comment_markers</span><span class="p">:</span> <span class="c1">#comment layout: [(&quot;/*&quot;, &quot;*/&quot;),(&quot;#&quot;,&quot;@&quot;)]</span>
                    <span class="k">if</span> <span class="n">stext</span> <span class="o">==</span> <span class="n">block_start</span> <span class="ow">or</span> <span class="n">stext</span> <span class="o">==</span> <span class="n">block_end</span><span class="p">:</span>
                        <span class="c1">#remove &quot;&quot;&quot; and &#39;&#39;&#39; from documentation lines</span>
                        <span class="c1">#see the l.text.lstrip()! if the lines ends with a white space</span>
                        <span class="c1">#the quotes will be kept! This is feature, to force the quotes</span>
                        <span class="c1">#in the output</span>
                        <span class="k">continue</span>
                    <span class="k">for</span> <span class="n">comment_start</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">single_comment_markers</span><span class="p">:</span> <span class="c1">#comment layout: [&quot;//&quot;,&quot;;&quot;]</span>
                        <span class="k">if</span> <span class="n">stext</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">comment_start</span><span class="p">):</span>
                            <span class="c1">#remove comments but not chapters</span>
                            <span class="n">l</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">indented</span><span class="p">(</span><span class="n">stext</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>

            <span class="k">yield</span> <span class="n">l</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
<div class="section" id="rstreader">
<h3>rstReader<a class="headerlink" href="#rstreader" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="rstReader">
<em class="property">class </em><code class="descname">rstReader</code><a class="headerlink" href="#rstReader" title="Permalink to this definition">¶</a></dt>
<dd><p>A reader for rst code. This class inherits <a class="reference internal" href="#Reader" title="Reader"><code class="xref py py-class docutils literal"><span class="pre">Reader</span></code></a>.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">rstReader</span><span class="p">(</span><span class="n">Reader</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_accept_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">Token</span><span class="o">.</span><span class="n">Comment</span>

    <span class="k">def</span> <span class="nf">_cut_comment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.. &quot;</span><span class="p">):</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>

        <span class="k">return</span> <span class="n">text</span>

    <span class="k">def</span> <span class="nf">filter_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        .. py:method:: filter_output(lines)</span>

<span class="sd">           See :py:meth:`Reader.filter_output`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;d&quot;</span><span class="p">:</span>
                <span class="c1">#remove comment chars in document lines</span>
                <span class="n">stext</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">stext</span> <span class="o">==</span> <span class="s1">&#39;.. &#39;</span><span class="p">:</span>
                    <span class="c1">#remove &quot;&quot;&quot; and &#39;&#39;&#39; from documentation lines</span>
                    <span class="c1">#see the l.text.lstrip()! if the lines ends with a white space</span>
                    <span class="c1">#the quotes will be kept! This is feature, to force the quotes</span>
                    <span class="c1">#in the output</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">stext</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.. &quot;</span><span class="p">):</span>
                    <span class="c1">#remove comments but not chapters</span>
                    <span class="n">l</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">indented</span><span class="p">(</span><span class="n">stext</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span>

            <span class="k">yield</span> <span class="n">l</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
</div>
<div class="section" id="document">
<h2>Document<a class="headerlink" href="#document" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id2">
<h3>Document<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="Document">
<em class="property">class </em><code class="descname">Document</code><span class="sig-paren">(</span><em>text</em>, <em>reader</em>, <em>fname</em>, <em>tokens</em><span class="sig-paren">)</span><a class="headerlink" href="#Document" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the mediator communicating with all other classes
to generate rst output.
:param string text: the source code to parse.
:param reader: An instance of <a class="reference internal" href="#Reader" title="Reader"><code class="xref py py-class docutils literal"><span class="pre">Reader</span></code></a>.
:param string fname: The file name of the source code.
:param tokens: A sequence of tokens usable for the <code class="docutils literal"><span class="pre">&#64;if</span></code> directive.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Document</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="c1">#Attributes</span>
    <span class="o">&lt;&lt;</span><span class="n">Document</span><span class="o">.</span><span class="n">errors</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Document</span><span class="o">.</span><span class="n">blocks</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Document</span><span class="o">.</span><span class="n">blocks_included</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Document</span><span class="o">.</span><span class="n">compiled_blocks</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Document</span><span class="o">.</span><span class="n">sub_documents</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Document</span><span class="o">.</span><span class="n">tokens</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Document</span><span class="o">.</span><span class="n">macros</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Document</span><span class="o">.</span><span class="n">fname</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Document</span><span class="o">.</span><span class="n">reader</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Document</span><span class="o">.</span><span class="n">lines</span><span class="o">&gt;&gt;</span>

    <span class="c1">#Methods</span>
    <span class="o">&lt;&lt;</span><span class="n">Document</span><span class="o">.</span><span class="n">__init__</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Document</span><span class="o">.</span><span class="n">process</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Document</span><span class="o">.</span><span class="n">get_subdoc</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Document</span><span class="o">.</span><span class="n">add_error</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Document</span><span class="o">.</span><span class="n">check_errors</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Document</span><span class="o">.</span><span class="n">collect_blocks</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Document</span><span class="o">.</span><span class="n">get_compiled_block</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Document</span><span class="o">.</span><span class="n">compile_block</span><span class="o">&gt;&gt;</span>
</pre></div>
</td></tr></table></div>
<dl class="attribute">
<dt id="Document.errors">
<code class="descname">errors</code><a class="headerlink" href="#Document.errors" title="Permalink to this definition">¶</a></dt>
<dd><p>A list of errors found during generation.</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="Document.blocks">
<code class="descname">blocks</code><a class="headerlink" href="#Document.blocks" title="Permalink to this definition">¶</a></dt>
<dd><p>A dictionary of all found blocks: Name -&gt; List of Lines</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">blocks</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="Document.blocks_included">
<code class="descname">blocks_included</code><a class="headerlink" href="#Document.blocks_included" title="Permalink to this definition">¶</a></dt>
<dd><p>A set containing all block names that have been included by
an &#64;include directive.</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">blocks_included</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="Document.compiled_blocks">
<code class="descname">compiled_blocks</code><a class="headerlink" href="#Document.compiled_blocks" title="Permalink to this definition">¶</a></dt>
<dd><p>A set containing all block names that have been already
compiled.</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">compiled_blocks</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="Document.sub_documents">
<code class="descname">sub_documents</code><a class="headerlink" href="#Document.sub_documents" title="Permalink to this definition">¶</a></dt>
<dd><p>A cache dictionary of sub documents, referenced by
<code class="docutils literal"><span class="pre">&#64;include</span></code> directives: Filename -&gt; Document</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">sub_documents</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="Document.tokens">
<code class="descname">tokens</code><a class="headerlink" href="#Document.tokens" title="Permalink to this definition">¶</a></dt>
<dd><p>A set of token names that can be used for the <code class="docutils literal"><span class="pre">&#64;if</span></code> directive.</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">tokens</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="Document.macros">
<code class="descname">macros</code><a class="headerlink" href="#Document.macros" title="Permalink to this definition">¶</a></dt>
<dd><p>A dictionary containing the macros that can be used
by the <code class="docutils literal"><span class="pre">&#64;subst</span></code> directive: Macro name -&gt; substitution.</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">macros</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="Document.fname">
<code class="descname">fname</code><a class="headerlink" href="#Document.fname" title="Permalink to this definition">¶</a></dt>
<dd><p>The file name of the document&#8217;s source.</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">fname</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="Document.reader">
<code class="descname">reader</code><a class="headerlink" href="#Document.reader" title="Permalink to this definition">¶</a></dt>
<dd><p>The instance of a <a class="reference internal" href="#Reader" title="Reader"><code class="xref py py-class docutils literal"><span class="pre">Reader</span></code></a> object.</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">reader</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="Document.lines">
<code class="descname">lines</code><a class="headerlink" href="#Document.lines" title="Permalink to this definition">¶</a></dt>
<dd><p>A list of <a class="reference internal" href="#Line" title="Line"><code class="xref py py-class docutils literal"><span class="pre">Line</span></code></a> objects representing the whole documents
split in lines.</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Document.__init__">
<code class="descname">__init__</code><span class="sig-paren">(</span><em>text</em>, <em>reader</em>, <em>fname</em>, <em>tokens</em><span class="sig-paren">)</span><a class="headerlink" href="#Document.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>The constructor.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">tokens</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">blocks_included</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">compiled_blocks</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sub_documents</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">tokens</span> <span class="ow">or</span> <span class="p">[])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">macros</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;__file__&quot;</span> <span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">fname</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                    <span class="s2">&quot;__codeprefix__&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;</span> <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fname</span> <span class="o">=</span> <span class="n">fname</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="o">=</span> <span class="n">reader</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

<dl class="method">
<dt id="Document.process">
<code class="descname">process</code><span class="sig-paren">(</span><em>show_warnings</em><span class="sig-paren">)</span><a class="headerlink" href="#Document.process" title="Permalink to this definition">¶</a></dt>
<dd><p>Processes the document and generates the output.
:param bool show_warnings: If <code class="docutils literal"><span class="pre">True</span></code> warnings are emitted.
:return: A string representing the rst output.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show_warnings</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">collect_blocks</span><span class="p">()</span>

    <span class="c1">#check if there are any lines in the file and add the according error message</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;empty file&quot;</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_errors</span><span class="p">()</span>
    <span class="k">elif</span> <span class="s2">&quot;&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">fname</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.rst&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;no @start() directive found (I need one)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_errors</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_compiled_block</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_errors</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">show_warnings</span><span class="p">:</span>
        <span class="o">&lt;&lt;</span><span class="n">show</span> <span class="n">warnings</span><span class="o">&gt;&gt;</span>
    <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">filter_output</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">return_text</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">text</span><span class="p">:</span>
         <span class="n">return_text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">attrgetter</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">),</span> <span class="n">text</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">return_text</span>
</pre></div>
</td></tr></table></div>
<p id="show-warnings"><strong>&lt;&lt;show warnings&gt;&gt;</strong></p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">blocks_included</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>           <span class="c1">#may not cause a warning</span>
<span class="bp">self</span><span class="o">.</span><span class="n">blocks_included</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;__macros__&quot;</span><span class="p">)</span> <span class="c1">#may not cause a warning</span>
<span class="n">unincluded</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">blocks_included</span>
<span class="k">if</span> <span class="n">unincluded</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;The following block were not included:&quot;</span><span class="p">)</span>
    <span class="n">warnings</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">b</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">unincluded</span> <span class="p">]</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">warnings</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;  </span><span class="si">%s</span><span class="s2">(line </span><span class="si">%i</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

<dl class="method">
<dt id="Document.get_subdoc">
<code class="descname">get_subdoc</code><span class="sig-paren">(</span><em>rpath</em><span class="sig-paren">)</span><a class="headerlink" href="#Document.get_subdoc" title="Permalink to this definition">¶</a></dt>
<dd><p>Tries to compile a document with the relative path rpath.
:param string rpath: The relative path to the root
containing document.
:return: A <a class="reference internal" href="#Document" title="Document"><code class="xref py py-class docutils literal"><span class="pre">Document</span></code></a> reference to the sub document.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_subdoc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rpath</span><span class="p">):</span>
    <span class="o">&lt;&lt;</span><span class="k">return</span> <span class="kn">from</span> <span class="nn">cache</span> <span class="k">if</span> <span class="n">possible</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">insert</span> <span class="n">macros</span> <span class="n">function</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">read</span> <span class="n">the</span> <span class="n">source</span> <span class="n">file</span><span class="o">&gt;&gt;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">sub_documents</span><span class="p">[</span><span class="n">rpath</span><span class="p">]</span> <span class="o">=</span> <span class="n">doc</span>
    <span class="k">return</span> <span class="n">doc</span>
</pre></div>
</td></tr></table></div>
<p id="return-from-cache-if-possible"><strong>&lt;&lt;return from cache if possible&gt;&gt;</strong></p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_documents</span><span class="p">[</span><span class="n">rpath</span><span class="p">]</span>
<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>
</td></tr></table></div>
<p id="insert-macros-function"><strong>&lt;&lt;insert macros function&gt;&gt;</strong></p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">insert_macros</span><span class="p">(</span><span class="n">subdoc</span><span class="p">):</span>
    <span class="c1">#if sub doc has no macros insert mine</span>
    <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;__macros__&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">subdoc</span><span class="o">.</span><span class="n">blocks</span>
        <span class="ow">and</span> <span class="s2">&quot;__macros__&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">):</span>
        <span class="n">file_</span> <span class="o">=</span> <span class="n">subdoc</span><span class="o">.</span><span class="n">macros</span><span class="p">[</span><span class="s2">&quot;__file__&quot;</span><span class="p">]</span> <span class="c1"># preserve __file__</span>
        <span class="n">subdoc</span><span class="o">.</span><span class="n">macros</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">macros</span><span class="p">)</span>
        <span class="n">subdoc</span><span class="o">.</span><span class="n">macros</span><span class="p">[</span><span class="s2">&quot;__file__&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_</span>
</pre></div>
</td></tr></table></div>
<p id="read-the-source-file"><strong>&lt;&lt;read the source file&gt;&gt;</strong></p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">head</span><span class="p">,</span> <span class="n">tail</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span>
<span class="n">fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="n">rpath</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1">#print &quot;try open&quot;, fpath</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Could not open: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fpath</span><span class="p">)</span>

<span class="k">else</span><span class="p">:</span>
    <span class="c1">#parse the file</span>
    <span class="n">lexer</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">get_lexer_for_filename</span><span class="p">(</span><span class="n">rpath</span><span class="p">)</span>
    <span class="n">single_comment_markers</span><span class="p">,</span>  <span class="n">block_comment_markers</span> <span class="o">=</span> <span class="n">get_comment_markers</span><span class="p">(</span><span class="n">lexer</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">readers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">lexer</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">Reader</span><span class="p">)(</span><span class="n">lexer</span><span class="p">,</span> <span class="n">single_comment_markers</span><span class="p">,</span>  <span class="n">block_comment_markers</span><span class="p">)</span>

    <span class="n">doc</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">rpath</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">)</span>
    <span class="n">doc</span><span class="o">.</span><span class="n">collect_blocks</span><span class="p">()</span>
    <span class="n">insert_macros</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

<dl class="method">
<dt id="Document.add_error">
<code class="descname">add_error</code><span class="sig-paren">(</span><em>line</em>, <em>text</em><span class="sig-paren">)</span><a class="headerlink" href="#Document.add_error" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds an error to the list.
:param integer line_number: The line number that causes the error.
:param string text: An error text.
:param string fname: Optionally add the filename</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="c1">#determine if the file is empty</span>
    <span class="k">if</span> <span class="n">line_number</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="n">line_number</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">Line</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">line</span><span class="p">,</span> <span class="n">text</span><span class="p">))</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

<dl class="method">
<dt id="Document.check_errors">
<code class="descname">check_errors</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Document.check_errors" title="Permalink to this definition">¶</a></dt>
<dd><p>Raises a <code class="docutils literal"><span class="pre">WebError</span></code> exception if error were found.</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">WebError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Document.collect_blocks">
<code class="descname">collect_blocks</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Document.collect_blocks" title="Permalink to this definition">¶</a></dt>
<dd><p>Collects all text blocks.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">collect_blocks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">blocks</span> <span class="o">=</span> <span class="p">[</span> <span class="n">d</span><span class="o">.</span><span class="n">collect_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
               <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">)</span>
               <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">l</span><span class="o">.</span><span class="n">directives</span> <span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="n">blocks</span><span class="p">)))</span>

    <span class="k">if</span> <span class="s2">&quot;__macros__&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_compiled_block</span><span class="p">(</span><span class="s2">&quot;__macros__&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

<dl class="method">
<dt id="Document.get_compiled_block">
<code class="descname">get_compiled_block</code><span class="sig-paren">(</span><em>name</em><span class="sig-paren">)</span><a class="headerlink" href="#Document.get_compiled_block" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the compiled version of a text block.
Compiled means: all directives where processed.
:param string name: The name of the text block:
:return: A list of <a class="reference internal" href="#Line" title="Line"><code class="xref py py-class docutils literal"><span class="pre">Line</span></code></a> objects representing
the text block.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_compiled_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">compiled_blocks</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">compile_block</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

<dl class="method">
<dt id="Document.compile_block">
<code class="descname">compile_block</code><span class="sig-paren">(</span><em>name</em>, <em>block</em><span class="sig-paren">)</span><a class="headerlink" href="#Document.compile_block" title="Permalink to this definition">¶</a></dt>
<dd><p>Compiles a text block.
:param string name: The name of the block
:param block: A list of <a class="reference internal" href="#Line" title="Line"><code class="xref py py-class docutils literal"><span class="pre">Line</span></code></a> objects representing
the text block to compile.
:return: A list of <a class="reference internal" href="#Line" title="Line"><code class="xref py py-class docutils literal"><span class="pre">Line</span></code></a> objects representing
the compiled text block.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compile_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">block</span><span class="p">):</span>
    <span class="o">&lt;&lt;</span><span class="n">find_next_directive</span><span class="o">&gt;&gt;</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">directive_index</span> <span class="o">=</span> <span class="n">find_next_directive</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">directive_index</span><span class="p">:</span> <span class="k">break</span>
        <span class="n">directive</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">directive_index</span>
        <span class="n">directive</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">compiled_blocks</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">block</span>
</pre></div>
</td></tr></table></div>
<p id="find-next-directive"><strong>&lt;&lt;find_next_directive&gt;&gt;</strong></p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">find_next_directive</span><span class="p">(</span><span class="n">block</span><span class="p">):</span>
    <span class="c1"># returns the next available directive</span>
    <span class="n">min_line</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">directives</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">priority</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                 <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">block</span><span class="p">)</span> <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">directives</span> <span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">min_line</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">prio</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">min_line</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">block</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">directives</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">index</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="line">
<h3>Line<a class="headerlink" href="#line" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="Line">
<em class="property">class </em><code class="descname">Line</code><span class="sig-paren">(</span><em>fname</em>, <em>index</em>, <em>text</em><span class="optional">[</span>, <em>directives</em><span class="optional">[</span>, <em>type</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Line" title="Permalink to this definition">¶</a></dt>
<dd><p>This class represents a text line.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Line</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="c1">#Attributes</span>
    <span class="o">&lt;&lt;</span><span class="n">Line</span><span class="o">.</span><span class="n">_directives</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Line</span><span class="o">.</span><span class="n">fname</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Line</span><span class="o">.</span><span class="n">index</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Line</span><span class="o">.</span><span class="n">text</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Line</span><span class="o">.</span><span class="n">type</span><span class="o">&gt;&gt;</span>

    <span class="c1">#Methods</span>
    <span class="o">&lt;&lt;</span><span class="n">Line</span><span class="o">.</span><span class="n">__init__</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Line</span><span class="o">.</span><span class="n">set</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Line</span><span class="o">.</span><span class="n">like</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Line</span><span class="o">.</span><span class="n">indented</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Line</span><span class="o">.</span><span class="n">change_indent</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Line</span><span class="o">.</span><span class="n">__len__</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Line</span><span class="o">.</span><span class="n">__repr__</span><span class="o">&gt;&gt;</span>

    <span class="c1">#Properties</span>
    <span class="o">&lt;&lt;</span><span class="n">Line</span><span class="o">.</span><span class="n">indent</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Line</span><span class="o">.</span><span class="n">sindent</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Line</span><span class="o">.</span><span class="n">directives</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">Line</span><span class="o">.</span><span class="n">directive</span><span class="o">&gt;&gt;</span>
</pre></div>
</td></tr></table></div>
<dl class="attribute">
<dt id="Line._directives">
<code class="descname">_directives</code><a class="headerlink" href="#Line._directives" title="Permalink to this definition">¶</a></dt>
<dd><p>A list of <a class="reference internal" href="#Directive" title="Directive"><code class="xref py py-class docutils literal"><span class="pre">Directive</span></code></a> objects, sorted
by their priority.</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">_directives</span> <span class="o">=</span> <span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="Line.fname">
<code class="descname">fname</code><a class="headerlink" href="#Line.fname" title="Permalink to this definition">¶</a></dt>
<dd><p>A string of the source&#8217;s file name the line belongs to.</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">fname</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="Line.index">
<code class="descname">index</code><a class="headerlink" href="#Line.index" title="Permalink to this definition">¶</a></dt>
<dd><p>The integer line index of the directive within the current block.</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="Line.text">
<code class="descname">text</code><a class="headerlink" href="#Line.text" title="Permalink to this definition">¶</a></dt>
<dd><p>A string containing the source line.</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="Line.type">
<code class="descname">type</code><a class="headerlink" href="#Line.type" title="Permalink to this definition">¶</a></dt>
<dd><p>A char representing the line type:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">d</span></code> stands for a document line</li>
<li><code class="docutils literal"><span class="pre">c</span></code> stands for a code line</li>
</ul>
</div></blockquote>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;d&quot;</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="Line.indent">
<code class="descname">indent</code><a class="headerlink" href="#Line.indent" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>An integer representing the line&#8217;s indentation.</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">indent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lstrip</span><span class="p">())</span>
</pre></div>
</div>
<dl class="attribute">
<dt id="Line.sindent">
<code class="descname">sindent</code><a class="headerlink" href="#Line.sindent" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>A string representation of the line&#8217;s indentation.</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">sindent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span>
</pre></div>
</div>
<dl class="attribute">
<dt id="Line.directives">
<code class="descname">directives</code><a class="headerlink" href="#Line.directives" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>A sorted sequence of <a class="reference internal" href="#Directive" title="Directive"><code class="xref py py-class docutils literal"><span class="pre">Directive</span></code></a> objects.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">directives</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_directives</span>


<span class="nd">@directives</span><span class="o">.</span><span class="n">setter</span>
<span class="k">def</span> <span class="nf">directives</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_directives</span> <span class="o">=</span> <span class="n">value</span><span class="p">[:]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_directives</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_directives</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">attrgetter</span><span class="p">(</span><span class="s2">&quot;priority&quot;</span><span class="p">))</span>
</pre></div>
</td></tr></table></div>
<dl class="attribute">
<dt id="Line.directive">
<code class="descname">directive</code><a class="headerlink" href="#Line.directive" title="Permalink to this definition">¶</a></dt>
<dd><p>The first of the contained <a class="reference internal" href="#Directive" title="Directive"><code class="xref py py-class docutils literal"><span class="pre">Directive</span></code></a> objects.</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">directive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">directives</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">directives</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Line.__init__">
<code class="descname">__init__</code><span class="sig-paren">(</span><em>name</em>, <em>index</em>, <em>text</em><span class="optional">[</span>, <em>directives</em><span class="optional">[</span>, <em>type</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Line.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>The constructor.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">directives</span><span class="o">=</span><span class="p">(),</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fname</span> <span class="o">=</span> <span class="n">fname</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">directives</span> <span class="o">=</span> <span class="n">directives</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

<dl class="method">
<dt id="Line.set">
<code class="descname">set</code><span class="sig-paren">(</span><span class="optional">[</span><em>index=None</em><span class="optional">[</span>, <em>type=None</em><span class="optional">[</span>, <em>directives=None</em><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Line.set" title="Permalink to this definition">¶</a></dt>
<dd><p>Changes the attributes <a class="reference internal" href="#Line.index" title="Line.index"><code class="xref py py-attr docutils literal"><span class="pre">index</span></code></a>, <a class="reference internal" href="#Line.type" title="Line.type"><code class="xref py py-attr docutils literal"><span class="pre">type</span></code></a>
and <a class="reference internal" href="#Line.directives" title="Line.directives"><code class="xref py py-attr docutils literal"><span class="pre">directives</span></code></a> at once.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>index</strong> (<em>integer</em>) &#8211; the line index.</li>
<li><strong>type</strong> (<em>char</em>) &#8211; Either <code class="docutils literal"><span class="pre">'d'</span></code> or <code class="docutils literal"><span class="pre">'c'</span></code>.</li>
<li><strong>directives</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#list" title="(in Python v2.7)"><em>list</em></a>) &#8211; A list of <code class="xref py py-class docutils literal"><span class="pre">DCirective</span></code> objects.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">The <a class="reference internal" href="#Line" title="Line"><code class="xref py py-class docutils literal"><span class="pre">Line</span></code></a> object <code class="docutils literal"><span class="pre">self</span></code>.</p>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">directives</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>

    <span class="k">if</span> <span class="nb">type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>

    <span class="k">if</span> <span class="n">directives</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directives</span> <span class="o">=</span> <span class="n">directives</span>

    <span class="k">return</span> <span class="bp">self</span>



<span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dline</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">dline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">directives</span><span class="p">:</span>
            <span class="n">d</span><span class="o">.</span><span class="n">line</span> <span class="o">=</span> <span class="n">dline</span>

    <span class="k">return</span> <span class="n">Line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">directives</span><span class="p">[:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

<dl class="method">
<dt id="Line.like">
<code class="descname">like</code><span class="sig-paren">(</span><em>text</em><span class="sig-paren">)</span><a class="headerlink" href="#Line.like" title="Permalink to this definition">¶</a></dt>
<dd><p>Clones the Line with a different text.</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">like</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">indented</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Line.indented">
<code class="descname">indented</code><span class="sig-paren">(</span><em>text</em><span class="sig-paren">)</span><a class="headerlink" href="#Line.indented" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the text, with the same indentation as <code class="docutils literal"><span class="pre">self</span></code>.</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">indented</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sindent</span> <span class="o">+</span> <span class="n">text</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Line.change_indent">
<code class="descname">change_indent</code><span class="sig-paren">(</span><em>delta</em><span class="sig-paren">)</span><a class="headerlink" href="#Line.change_indent" title="Permalink to this definition">¶</a></dt>
<dd><p>Changes the lines indentation.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">change_indent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delta</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="o">-</span><span class="n">delta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">[</span><span class="n">delta</span><span class="p">:]</span>

    <span class="k">elif</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">*</span><span class="n">delta</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span>

    <span class="k">return</span> <span class="bp">self</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

<dl class="method">
<dt id="Line.__len__">
<code class="descname">__len__</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Line.__len__" title="Permalink to this definition">¶</a></dt>
<dd><p>returns the length of the stripped <a class="reference internal" href="#Line.text" title="Line.text"><code class="xref py py-attr docutils literal"><span class="pre">text</span></code></a>.</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Line.__repr__">
<code class="descname">__repr__</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Line.__repr__" title="Permalink to this definition">¶</a></dt>
<dd><p>returns a textual representation of the line.</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;Line(</span><span class="si">%i</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directives</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="file-layout">
<h2>File Layout<a class="headerlink" href="#file-layout" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">&lt;&lt;</span><span class="n">imports</span><span class="o">&gt;&gt;</span>
<span class="o">&lt;&lt;</span><span class="n">management</span><span class="o">&gt;&gt;</span>
<span class="o">&lt;&lt;</span><span class="n">directives</span><span class="o">&gt;&gt;</span>
<span class="o">&lt;&lt;</span><span class="n">readers</span><span class="o">&gt;&gt;</span>


<span class="o">&lt;&lt;</span><span class="n">Line</span><span class="o">&gt;&gt;</span>
<span class="o">&lt;&lt;</span><span class="n">document</span><span class="o">&gt;&gt;</span>




<span class="o">&lt;&lt;</span><span class="n">create_out_file_name</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">create_out_file_name_index</span><span class="o">&gt;&gt;</span>


<span class="o">&lt;&lt;</span><span class="n">insert_filename_in_index_file</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">create_doc_directory</span><span class="o">&gt;&gt;</span>


<span class="o">&lt;&lt;</span><span class="n">replace_path_seperator</span><span class="o">&gt;&gt;</span>


<span class="o">&lt;&lt;</span><span class="n">write_static</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">create_index_file</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">parsing</span><span class="o">&gt;&gt;</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">parsing</span><span class="p">()</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">())</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">warnings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">options</span><span class="o">.</span><span class="n">warnings</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">print_help</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">index_rst</span> <span class="o">=</span> <span class="s2">&quot;index.rst&quot;</span>
    <span class="n">start_block</span> <span class="o">=</span> <span class="s2">&quot;.. start(generated)&quot;</span>
    <span class="n">end_block</span> <span class="o">=</span> <span class="s2">&quot;.. end(generated)&quot;</span>
</pre></div>
</td></tr></table></div>
<p>The program checks if a -r flag was given and if so, save the current directory and change it to the given one.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">previous_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

<span class="c1">#The user input (respectively the input antiweb sets when none is given) can be relative,</span>
<span class="c1">#so we grab the absolute path to work with.</span>
<span class="n">absolute_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">recursive</span><span class="p">:</span>
    <span class="n">directory</span> <span class="o">=</span> <span class="n">absolute_path</span>

    <span class="c1">#Check if the given path refers to an existing directory.</span>
    <span class="c1">#The program aborts if the directory does not exist or if the path refers to a file.</span>
    <span class="c1">#A file is not allowed here because the -r option requires a directory.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;directory not found: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
        <span class="n">index_rst</span> <span class="o">=</span> <span class="n">create_index_file</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="n">index_rst</span><span class="p">,</span> <span class="n">start_block</span><span class="p">,</span> <span class="n">end_block</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>The program walks through the given directory and all subdirectories. The absolute file names
are retrieved. Only files with the allowed extensions are processed.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#Only files with the following extensions will be processed</span>
<span class="n">ext_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;.cs&quot;</span><span class="p">,</span><span class="s2">&quot;.cpp&quot;</span><span class="p">,</span><span class="s2">&quot;.py&quot;</span><span class="p">,</span><span class="s2">&quot;.cc&quot;</span><span class="p">,</span> <span class="s2">&quot;.rst&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">topdown</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="ow">and</span> <span class="n">fname</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">ext_tuple</span><span class="p">):</span>
            <span class="n">write</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">index_rst</span><span class="p">,</span> <span class="n">start_block</span><span class="p">,</span> <span class="n">end_block</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>This else will take place when the -r flag is not given.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">else</span><span class="p">:</span>
    <span class="n">absolute_file_path</span> <span class="o">=</span> <span class="n">absolute_path</span>

    <span class="c1">#Check if the given path refers to an existing file.</span>
    <span class="c1">#The program aborts if the file does not exist or if the path refers to a directory.</span>
    <span class="c1">#A directory is not allowed here because a directory can only be used with the -r option.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">absolute_file_path</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;file not found: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">absolute_file_path</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">absolute_file_path</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">directory</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
        <span class="c1">#check if output contains a directory or a file name</span>
        <span class="n">index_rst</span> <span class="o">=</span> <span class="n">create_index_file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">index_rst</span><span class="p">,</span> <span class="n">start_block</span><span class="p">,</span> <span class="n">end_block</span><span class="p">)</span>

    <span class="n">write</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">absolute_file_path</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">index_rst</span><span class="p">,</span> <span class="n">start_block</span><span class="p">,</span> <span class="n">end_block</span><span class="p">)</span>

<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">previous_dir</span><span class="p">)</span>
<span class="k">return</span> <span class="kc">True</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="writing-the-documentation-files">
<h3>Writing the documentation files<a class="headerlink" href="#writing-the-documentation-files" title="Permalink to this headline">¶</a></h3>
<p>From the given file a .rst file will be created if it contains an antiweb <code class="xref py py-class docutils literal"><span class="pre">start()</span> <span class="pre">directive</span></code>.
The following function is called for the creation of the documentation files.</p>
<dl class="method">
<dt id="write">
<code class="descname">write</code><span class="sig-paren">(</span><em>working_dir</em>, <em>input_file</em>, <em>options</em>, <em>index_file</em>, <em>start_block</em>, <em>end_block</em><span class="sig-paren">)</span><a class="headerlink" href="#write" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates the corresponding documention file and optionally adds the processed file to the index file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>working_dir</strong> &#8211; Current working directory.</li>
<li><strong>input_file</strong> &#8211; Contains the absolute path of the currently processed file.</li>
<li><strong>options</strong> &#8211; Commandline options.</li>
<li><strong>index_file</strong> &#8211; Absolute path of the index file.</li>
<li><strong>start_block</strong> &#8211; String which contains the generated index block start definition.</li>
<li><strong>end_block</strong> &#8211; String which contains the generated index block end definition.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>Before the input file is processed the name of the output file has to be computed.
How the output file name is created depends on the different commandline options.
When there is no output option given the output file name is created in the following way:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Input File</th>
<th class="head">Output File</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">C:\antiweb\testing.cs</span></code></td>
<td><em>C:\antiweb\testing.rst</em></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">C:\antiweb\testing.rst</span></code></td>
<td><em>C:\antiweb\testing_docs.rst</em></td>
</tr>
</tbody>
</table>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="n">working_dir</span><span class="p">,</span> <span class="n">input_file</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">index_file</span><span class="p">,</span> <span class="n">start_block</span><span class="p">,</span> <span class="n">end_block</span><span class="p">):</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">output</span>
    <span class="n">recursive</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">recursive</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span><span class="p">:</span>
        <span class="n">out_file</span> <span class="o">=</span> <span class="n">create_out_file_name</span><span class="p">(</span><span class="n">working_dir</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">input_file</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>If there is an output given, we have to distinguish between the recursive and non-recursive option.
When the recursive option is used in combination with the output option, the output parameter is treated as the documentation directory:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Input File</th>
<th class="head">Output File</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">C:\antiweb\</span> <span class="pre">-r</span> <span class="pre">-o</span> <span class="pre">report.rst</span></code></td>
<td><em>C:\antiweb\report.rst\file.rst</em></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">C:\antiweb\</span> <span class="pre">-r</span> <span class="pre">-o</span> <span class="pre">report</span></code></td>
<td><em>C:\antiweb\report\file.rst</em></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">C:\antiweb\</span> <span class="pre">-r</span> <span class="pre">-o</span> <span class="pre">C:\antiweb\report.rst</span></code></td>
<td><em>C:\antiweb\report.rst\file.rst</em></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">C:\antiweb\</span> <span class="pre">-r</span> <span class="pre">-o</span> <span class="pre">\..\report.rst</span></code></td>
<td><em>C:\report.rst\file.rst</em></td>
</tr>
</tbody>
</table>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">else</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
        <span class="c1">#The output parameter is treated as a directory.</span>
        <span class="c1">#If it is a relative path it is combined with the current working directory.</span>
        <span class="n">directory</span> <span class="o">=</span> <span class="n">output</span>
        <span class="n">out_file</span> <span class="o">=</span> <span class="n">create_out_file_name</span><span class="p">(</span><span class="n">working_dir</span><span class="p">,</span><span class="n">directory</span><span class="p">,</span><span class="n">input_file</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>When the output option is used without the recursive option the output file name is computed in the following way:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Input File</th>
<th class="head">Output File</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">C:\antiweb\testing.cs</span> <span class="pre">-o</span> <span class="pre">report.rst</span></code></td>
<td><em>C:\antiweb\report.rst</em></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">C:\antiweb\testing.cs</span> <span class="pre">-o</span> <span class="pre">report</span></code></td>
<td><em>C:\antiweb\report\testing.rst</em></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">C:\antiweb\testing.cs</span> <span class="pre">-o</span> <span class="pre">\..\report</span></code></td>
<td><em>C:\report\testing.rst</em></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">C:\antiweb\testing.cs</span> <span class="pre">-o</span> <span class="pre">report\report.rst</span></code></td>
<td><em>C:\antiweb\report\report.rst</em></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">C:\antiweb\testing.cs</span> <span class="pre">-o</span> <span class="pre">report\report.rst\</span></code></td>
<td><em>C:\antiweb\report\report.rst\testing.rst</em></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">C:\antiweb\testing.cs</span> <span class="pre">-o</span> <span class="pre">C:\report\report.rst</span></code></td>
<td><em>C:\report\report.rst</em></td>
</tr>
</tbody>
</table>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="k">else</span><span class="p">:</span>
        <span class="c1">#Get the file extension from output parameter</span>
        <span class="n">file_extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">output</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">file_extension</span><span class="p">:</span>
            <span class="c1">#If there is a file extension the last part of the output parameter is treated as the output file name.</span>
            <span class="n">path_tokens</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
            <span class="n">directory</span> <span class="o">=</span> <span class="n">path_tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">path_tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1">#If directory contains an absolute path the working directory will be ignored,</span>
            <span class="c1">#otherwise all three parameters will be joined</span>
            <span class="n">out_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_dir</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
            <span class="n">out_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">out_file</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#If there is no file extension the whole output parameter is treated as the report directory.</span>
            <span class="n">directory</span> <span class="o">=</span> <span class="n">output</span>
            <span class="n">out_file</span> <span class="o">=</span> <span class="n">create_out_file_name</span><span class="p">(</span><span class="n">working_dir</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">input_file</span><span class="p">)</span>

<span class="c1">#Create the documentation directory. If it can&#39;t be created the program exits.</span>
<span class="n">create_doc_directory</span><span class="p">(</span><span class="n">out_file</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Now the input file is processed and the corresponding documentation file is created.
If processing is successful, &#8216;&#8217;could_process&#8217;&#8217; is set to &#8216;&#8217;True&#8217;&#8216;.</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">could_process</span> <span class="o">=</span> <span class="n">process_file</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">out_file</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">token</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">warnings</span><span class="p">)</span>
</pre></div>
</div>
<p>If the file was processed successfully and the index option is used, the file name which should be inserted
in the generated index file block has to be computed first. Afterwards the file name is inserted into the
index file (see <a class="reference internal" href="#insert_filename_in_index_file" title="insert_filename_in_index_file"><code class="xref py py-meth docutils literal"><span class="pre">insert_filename_in_index_file()</span></code></a>).</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">index</span> <span class="ow">and</span> <span class="n">could_process</span><span class="p">:</span>
    <span class="n">out_file_name_index</span> <span class="o">=</span> <span class="n">create_out_file_name_index</span><span class="p">(</span><span class="n">out_file</span><span class="p">,</span> <span class="n">working_dir</span><span class="p">,</span> <span class="n">recursive</span><span class="p">)</span>
    <span class="n">insert_filename_in_index_file</span><span class="p">(</span><span class="n">out_file_name_index</span><span class="p">,</span> <span class="n">index_file</span><span class="p">,</span> <span class="n">start_block</span><span class="p">,</span> <span class="n">end_block</span><span class="p">)</span>
</pre></div>
</div>
<dl class="method">
<dt id="create_out_file_name">
<code class="descname">create_out_file_name</code><span class="sig-paren">(</span><em>working_dir</em>, <em>directory</em>, <em>input_file</em><span class="sig-paren">)</span><a class="headerlink" href="#create_out_file_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes the absolute path of the output file name. The input file name suffix is replaced by
&#8221;.rst&#8221;. If the input file name ends with &#8221;.rst&#8221; the string &#8220;_docs&#8221; is added before the suffix.
If directory contains a relative path, then the paths of the working_dir and the directory
are combined with the input file name. Otherwise, the directory is combined with the
input file name.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>working_dir</strong> &#8211; Absolute path of the current working directory.</li>
<li><strong>directory</strong> &#8211; The documentation directory (absolute or relative)</li>
<li><strong>input_file</strong> &#8211; The absolute path to the file which should be processed.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">The path of the output file.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Working_Dir</th>
<th class="head">Directory</th>
<th class="head">Input_File_Name</th>
<th class="head">Output_File_Name</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><em>C:\antiweb\</em></td>
<td>doc</td>
<td><em>C:\antiweb\testing.py</em></td>
<td><em>C:\antiweb\doc\testing.rst</em></td>
</tr>
<tr class="row-odd"><td><em>C:\antiweb\</em></td>
<td>&nbsp;</td>
<td><em>C:\antiweb\testing.py</em></td>
<td><em>C:\antiweb\testing.rst</em></td>
</tr>
<tr class="row-even"><td><em>C:\antiweb\</em></td>
<td><em>C:\doc\</em></td>
<td><em>testing.py</em></td>
<td><em>C:\doc\testing.rst</em></td>
</tr>
<tr class="row-odd"><td><em>C:\antiweb\</em></td>
<td>doc</td>
<td><em>C:\antiweb\testing.rst</em></td>
<td><em>C:\antiweb\doc\testing_docs.rst</em></td>
</tr>
</tbody>
</table>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_out_file_name</span><span class="p">(</span><span class="n">working_dir</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">input_file</span><span class="p">):</span>

    <span class="n">docs</span> <span class="o">=</span> <span class="s2">&quot;_docs&quot;</span>
    <span class="n">rst_suffix</span> <span class="o">=</span> <span class="s2">&quot;.rst&quot;</span>
    <span class="n">out_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">input_file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">rst_suffix</span><span class="p">):</span>
        <span class="n">out_file_path</span> <span class="o">=</span>  <span class="n">out_file_path</span> <span class="o">+</span> <span class="n">docs</span>

    <span class="n">out_file_path</span> <span class="o">=</span>  <span class="n">out_file_path</span> <span class="o">+</span> <span class="n">rst_suffix</span>

    <span class="n">out_file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">out_file_path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1">#If directory contains an absolute path, the working directory is ignored.</span>
    <span class="n">out_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_dir</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">out_file_name</span><span class="p">)</span>
    <span class="n">out_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">out_file</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out_file</span>
</pre></div>
</td></tr></table></div>
<dl class="method">
<dt id="create_out_file_name_index">
<code class="descname">create_out_file_name_index</code><span class="sig-paren">(</span><em>out_file</em>, <em>working_dir</em>, <em>recursive</em><span class="sig-paren">)</span><a class="headerlink" href="#create_out_file_name_index" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates the file name which should be inserted into the generated index file block.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>out_file</strong> &#8211; Absolute path of the output file.</li>
<li><strong>index_file</strong> &#8211; Absolute path of the index file.</li>
<li><strong>recursive</strong> &#8211; Boolean which indicates whether the recursive commandline options is used.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">The file name which should be inserted in the generated index file block.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>If the user added the -i flag, an index file (documentation base file) is created which contains all processed files.
The names of the processed files are added between the <code class="xref py py-class docutils literal"><span class="pre">start(generated)</span></code> and <code class="xref py py-class docutils literal"><span class="pre">end(generated)</span></code> directives.
The file names which are inserted into the index file are computed in the following way:</p>
<p>When the recursive option is used the file name in the index file is a relative path without extension.
Otherwise the index file will only contain the filename without extension.
Path seperator characters are replaced by &#8220;_&#8221;.</p>
<div class="line-block">
<div class="line">Non-recursive example with current processed file: <em>C:\antiweb\report.rst\file.rst</em>:</div>
<div class="line"><code class="xref py py-class docutils literal"><span class="pre">start(generated)</span></code></div>
<div class="line"><code class="xref py py-class docutils literal"><span class="pre">file</span></code></div>
<div class="line"><code class="xref py py-class docutils literal"><span class="pre">end(generated)</span></code></div>
<div class="line"><br /></div>
<div class="line">Recursive example with current processed file: <em>C:\antiweb\report.rst\file.rst</em>:</div>
<div class="line"><code class="xref py py-class docutils literal"><span class="pre">start(generated)</span></code></div>
<div class="line"><code class="xref py py-class docutils literal"><span class="pre">report.rst_file</span></code></div>
<div class="line"><code class="xref py py-class docutils literal"><span class="pre">end(generated)</span></code></div>
<div class="line"><br /></div>
</div>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_out_file_name_index</span><span class="p">(</span><span class="n">out_file</span><span class="p">,</span> <span class="n">working_dir</span><span class="p">,</span> <span class="n">recursive</span><span class="p">):</span>

    <span class="c1">#1) Obtain only the file name</span>
    <span class="n">out_file_name_index</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">out_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1">#2) Remove the extension</span>
    <span class="n">out_file_name_index</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">out_file_name_index</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
        <span class="n">out_file_name_index</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">out_file_name_index</span><span class="p">,</span> <span class="n">working_dir</span><span class="p">)</span>
        <span class="n">out_file_name_index</span> <span class="o">=</span> <span class="n">replace_path_seperator</span><span class="p">(</span><span class="n">out_file_name_index</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">out_file_name_index</span>
</pre></div>
</td></tr></table></div>
<dl class="method">
<dt id="insert_filename_in_index_file">
<code class="descname">insert_filename_in_index_file</code><span class="sig-paren">(</span><em>file_name</em>, <em>index_file</em>, <em>start_block</em>, <em>end_block</em><span class="sig-paren">)</span><a class="headerlink" href="#insert_filename_in_index_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Inserts the given file name into the generated block in the index file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>file_name</strong> &#8211; The file name which should be inserted into the index file.</li>
<li><strong>index_file</strong> &#8211; Absolute path of the index file.</li>
<li><strong>start_block</strong> &#8211; String which contains the generated index block start definition.</li>
<li><strong>end_block</strong> &#8211; String which contains the generated index block end definition.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>If the user added the -i flag, an index file (documentation base file) is created which contains all processed files.
Between the <code class="xref py py-class docutils literal"><span class="pre">start(generated)</span></code> and <code class="xref py py-class docutils literal"><span class="pre">end(generated)</span></code> directives the names of the processed files are added.
Read  <a class="reference internal" href="#create_out_file_name_index" title="create_out_file_name_index"><code class="xref py py-meth docutils literal"><span class="pre">create_out_file_name_index()</span></code></a> for more information about how the inserted file name is computed.
Files can be manually added after the <code class="xref py py-class docutils literal"><span class="pre">end(generated)</span></code> directive.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">insert_filename_in_index_file</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">index_file</span><span class="p">,</span> <span class="n">start_block</span><span class="p">,</span> <span class="n">end_block</span><span class="p">):</span>

    <span class="c1">#At first the position has to be found where the new file should be inserted.</span>
    <span class="n">content</span><span class="p">,</span> <span class="n">endline</span> <span class="o">=</span> <span class="n">search_for_generated_block</span><span class="p">(</span><span class="n">index_file</span><span class="p">,</span> <span class="n">start_block</span><span class="p">,</span> <span class="n">end_block</span><span class="p">)</span>

    <span class="c1">#If the index file does not contain the generated block, it is appended.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">content</span><span class="p">:</span>
        <span class="n">write_static</span><span class="p">(</span><span class="n">index_file</span><span class="p">,</span> <span class="n">start_block</span><span class="p">,</span> <span class="n">end_block</span><span class="p">)</span>
        <span class="n">content</span><span class="p">,</span> <span class="n">endline</span> <span class="o">=</span> <span class="n">search_for_generated_block</span><span class="p">(</span><span class="n">index_file</span><span class="p">,</span> <span class="n">start_block</span><span class="p">,</span> <span class="n">end_block</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">endline</span><span class="p">:</span>
        <span class="c1">#The new file name is inserted into the index file contents.</span>
        <span class="n">content</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">endline</span><span class="p">,</span> <span class="s2">&quot;   &quot;</span> <span class="o">+</span> <span class="n">file_name</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1">#The adapted index file contents are written out to the index file.</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">index_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">index_out</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
                <span class="n">index_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Error: Could not write to index file: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>  <span class="n">index_file</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<dl class="method">
<dt id="create_doc_directory">
<code class="descname">create_doc_directory</code><span class="sig-paren">(</span><em>out_file</em><span class="sig-paren">)</span><a class="headerlink" href="#create_doc_directory" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates the documentation directory if it does not yet exist.
If an error occurs, the program exits.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>out_file</strong> &#8211; The path to the output file.</td>
</tr>
</tbody>
</table>
</dd></dl>

<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_doc_directory</span><span class="p">(</span><span class="n">out_file</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">out_file_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">out_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">out_file_directory</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">out_file_directory</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Error: Documentation Directory: </span><span class="si">%s</span><span class="s2"> could not be created&quot;</span><span class="p">,</span>  <span class="n">out_file_directory</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<dl class="method">
<dt id="replace_path_seperator">
<code class="descname">replace_path_seperator</code><span class="sig-paren">(</span><em>file_path</em><span class="sig-paren">)</span><a class="headerlink" href="#replace_path_seperator" title="Permalink to this definition">¶</a></dt>
<dd><p>Replaces OS specific path seperator characters by &#8216;_&#8217;.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>file_path</strong> &#8211; The path to a file.</td>
</tr>
</tbody>
</table>
</dd></dl>

<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">replace_path_seperator</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
<span class="c1">#Path seperator characters are replaced by &quot;_&quot; in the index file</span>
    <span class="k">if</span> <span class="n">_platform</span> <span class="o">==</span> <span class="s2">&quot;linux&quot;</span> <span class="ow">or</span> <span class="n">_platform</span> <span class="o">==</span> <span class="s2">&quot;linux2&quot;</span><span class="p">:</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_platform</span> <span class="o">==</span> <span class="s2">&quot;win32&quot;</span><span class="p">:</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">file_path</span>
</pre></div>
</td></tr></table></div>
<dl class="method">
<dt id="write_static">
<code class="descname">write_static</code><span class="sig-paren">(</span><em>index_file</em>, <em>start_of_block</em>, <em>end_of_block</em><span class="sig-paren">)</span><a class="headerlink" href="#write_static" title="Permalink to this definition">¶</a></dt>
<dd><p>Writes the static contents to the index file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>index_file</strong> &#8211; Absolute path of the index file.</li>
<li><strong>start_block</strong> &#8211; String which contains the generated index block start definition.</li>
<li><strong>end_block</strong> &#8211; String which contains the generated index block end definition.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">write_static</span><span class="p">(</span><span class="n">index_file</span><span class="p">,</span> <span class="n">start_block</span><span class="p">,</span> <span class="n">end_block</span><span class="p">):</span>

    <span class="n">index_generated</span> <span class="o">=</span> <span class="s2">&quot;   &quot;</span> <span class="o">+</span> <span class="n">start_block</span> <span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   &quot;</span> <span class="o">+</span> <span class="n">end_block</span>
    <span class="n">write_option</span> <span class="o">=</span> <span class="s2">&quot;w&quot;</span>
    <span class="n">index_content</span> <span class="o">=</span> <span class="s2">&quot;Documentation</span><span class="se">\n</span><span class="s2">=======================</span><span class="se">\n</span><span class="s2">Contents:</span><span class="se">\n\n</span><span class="s2">.. toctree::</span><span class="se">\n</span><span class="s2">   :maxdepth: 2</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">index_generated</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">index_file</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">index_file</span><span class="p">,</span> <span class="n">write_option</span><span class="p">)</span> <span class="k">as</span> <span class="n">index_out</span><span class="p">:</span>
            <span class="n">index_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">index_content</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Error: Index File: </span><span class="si">%s</span><span class="s2"> could not be created.&quot;</span><span class="p">,</span>  <span class="n">index_file</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<dl class="method">
<dt id="create_index_file">
<code class="descname">create_index_file</code><span class="sig-paren">(</span><em>working_dir</em>, <em>directory</em>, <em>file_name</em>, <em>start_block</em>, <em>end_block</em><span class="sig-paren">)</span><a class="headerlink" href="#create_index_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates the index file and writes the standard index file contents into the file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>working_dir</strong> &#8211; Current working directory.</li>
<li><strong>directory</strong> &#8211; Output directory (may contain a directory path or a directory name)</li>
<li><strong>file_name</strong> &#8211; Filename of the index file.</li>
<li><strong>start_block</strong> &#8211; String which contains the generated index block start definition.</li>
<li><strong>end_block</strong> &#8211; String which contains the generated index block end definition.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">The absolute path of the index file.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_index_file</span><span class="p">(</span><span class="n">working_dir</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">start_block</span><span class="p">,</span> <span class="n">end_block</span><span class="p">):</span>

    <span class="n">index_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_dir</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
    <span class="n">index_file_absolute</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">index_file</span><span class="p">)</span>

    <span class="c1">#index file is overwritten if it already exists</span>
    <span class="n">write_static</span><span class="p">(</span><span class="n">index_file_absolute</span><span class="p">,</span> <span class="n">start_block</span><span class="p">,</span> <span class="n">end_block</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">index_file</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="process-file">
<h3>process_file<a class="headerlink" href="#process-file" title="Permalink to this headline">¶</a></h3>
<p>If no output name was declared, the input name will be given</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">process_file</span><span class="p">(</span><span class="n">in_file</span><span class="p">,</span> <span class="n">out_file</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">warnings</span><span class="p">):</span>
</pre></div>
</div>
<p>The output text will be written in the output file. If there is an output text, the function returns could_write as True.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">could_write</span> <span class="o">=</span> <span class="kc">False</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">text_output</span> <span class="o">=</span> <span class="n">generate</span><span class="p">(</span><span class="n">in_file</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">warnings</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">text_output</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">out_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text_output</span><span class="p">)</span>
        <span class="n">could_write</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="n">WebError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Errors:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">error_list</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;  in line </span><span class="si">%i</span><span class="s2">(</span><span class="si">%s</span><span class="s2">): </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">l</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">l</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;      </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">l</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

<span class="k">return</span> <span class="n">could_write</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="search-for-generated-block">
<h3>search_for_generated_block<a class="headerlink" href="#search-for-generated-block" title="Permalink to this headline">¶</a></h3>
<p>The index file is searched for the generated block. The contents in the generated block are deleted.
Afterwards the whole file content and the endline of the generated block are returned.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">search_for_generated_block</span><span class="p">(</span><span class="n">index_rst</span><span class="p">,</span> <span class="n">start_of_block</span><span class="p">,</span> <span class="n">end_of_block</span><span class="p">):</span>

    <span class="n">startline</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">endline</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">content</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">index_rst</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">index_file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">index_file</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">start_of_block</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">startline</span> <span class="o">=</span> <span class="n">num</span>
            <span class="k">if</span> <span class="n">end_of_block</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">endline</span> <span class="o">=</span> <span class="n">num</span>

            <span class="k">if</span> <span class="n">startline</span> <span class="ow">and</span> <span class="n">endline</span><span class="p">:</span>
                <span class="n">index_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">index_file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                <span class="c1">#delete content of generated block</span>
                <span class="k">del</span> <span class="n">content</span><span class="p">[</span><span class="n">startline</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">endline</span><span class="p">]</span>
                <span class="c1">#set endline = old_endline - deleted lines</span>
                <span class="n">endline</span> <span class="o">=</span> <span class="n">endline</span> <span class="o">-</span> <span class="p">(</span><span class="n">endline</span><span class="o">-</span><span class="p">(</span><span class="n">startline</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">endline</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<dl class="method">
<dt>
<code class="descname">def parsing()</code></dt>
<dd><p>All possible input options are being defined, as well as their help-message, type and variable the values are stored in.
If no arguments are given (the user did not provide a filepath), the current directory is set as the argument.</p>
</dd></dl>

<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">parsing</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">OptionParser</span><span class="p">(</span><span class="s2">&quot;usage: %prog [options] SOURCEFILE&quot;</span><span class="p">,</span>
                          <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Tangles a source code file to a rst file.&quot;</span><span class="p">,</span>
                          <span class="n">version</span><span class="o">=</span><span class="s2">&quot;%prog &quot;</span> <span class="o">+</span> <span class="n">__version__</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-o&quot;</span><span class="p">,</span> <span class="s2">&quot;--output&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                      <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The output filename&quot;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-t&quot;</span><span class="p">,</span> <span class="s2">&quot;--token&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;token&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span>
                      <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;defines a token, usable by @if directives&quot;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-w&quot;</span><span class="p">,</span> <span class="s2">&quot;--warnings&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;warnings&quot;</span><span class="p">,</span>
                      <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_false&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;suppresses warnings&quot;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-r&quot;</span><span class="p">,</span> <span class="s2">&quot;--recursive&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;recursive&quot;</span><span class="p">,</span>
                      <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Process every file in given directory&quot;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-i&quot;</span><span class="p">,</span> <span class="s2">&quot;--index&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">,</span>
                      <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Automatically write file(s) to Sphinx&#39; index.rst&quot;</span><span class="p">)</span>

    <span class="n">options</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="c1">#There is no argument given, so we assume the user wants to use the current directory.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
    <span class="c1"># parsing() returns the selected options, arguments (the filepath/folderpath) and the parser</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">parser</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<dl class="docutils">
<dt>if __name__ == &#8220;__main__&#8221;:</dt>
<dd>main()</dd>
</dl>
</div>
<div class="section" id="imports">
<h3>&lt;&lt;imports&gt;&gt;<a class="headerlink" href="#imports" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">optparse</span> <span class="k">import</span> <span class="n">OptionParser</span>
<span class="kn">import</span> <span class="nn">pygments.lexers</span> <span class="k">as</span> <span class="nn">pm</span>
<span class="kn">from</span> <span class="nn">pygments.token</span> <span class="k">import</span> <span class="n">Token</span>
<span class="kn">import</span> <span class="nn">bisect</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="k">import</span> <span class="n">platform</span> <span class="k">as</span> <span class="n">_platform</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="k">import</span> <span class="n">BeautifulSoup</span><span class="p">,</span>  <span class="n">Tag</span><span class="p">,</span>  <span class="n">NavigableString</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="management">
<h3>&lt;&lt;management&gt;&gt;<a class="headerlink" href="#management" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;0.3.2&quot;</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;antiweb&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">WebError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error_list</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_list</span> <span class="o">=</span> <span class="n">error_list</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id3">
<h3>&lt;&lt;directives&gt;&gt;<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">&lt;&lt;</span><span class="n">Directive</span><span class="o">&gt;&gt;</span>
<span class="o">&lt;&lt;</span><span class="n">NameDirective</span><span class="o">&gt;&gt;</span>
<span class="o">&lt;&lt;</span><span class="n">Start</span><span class="o">&gt;&gt;</span>
<span class="o">&lt;&lt;</span><span class="n">RStart</span><span class="o">&gt;&gt;</span>
<span class="o">&lt;&lt;</span><span class="n">CStart</span><span class="o">&gt;&gt;</span>
<span class="o">&lt;&lt;</span><span class="n">End</span><span class="o">&gt;&gt;</span>
<span class="o">&lt;&lt;</span><span class="n">Fi</span><span class="o">&gt;&gt;</span>
<span class="o">&lt;&lt;</span><span class="n">If</span><span class="o">&gt;&gt;</span>
<span class="o">&lt;&lt;</span><span class="n">Define</span><span class="o">&gt;&gt;</span>
<span class="o">&lt;&lt;</span><span class="n">Enifed</span><span class="o">&gt;&gt;</span>
<span class="o">&lt;&lt;</span><span class="n">Subst</span><span class="o">&gt;&gt;</span>
<span class="o">&lt;&lt;</span><span class="n">Include</span><span class="o">&gt;&gt;</span>
<span class="o">&lt;&lt;</span><span class="n">RInclude</span><span class="o">&gt;&gt;</span>
<span class="o">&lt;&lt;</span><span class="n">Edoc</span><span class="o">&gt;&gt;</span>
<span class="o">&lt;&lt;</span><span class="n">Code</span><span class="o">&gt;&gt;</span>
<span class="o">&lt;&lt;</span><span class="n">Ignore</span><span class="o">&gt;&gt;</span>
<span class="o">&lt;&lt;</span><span class="n">Indent</span><span class="o">&gt;&gt;</span>

<span class="n">directives</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;start&quot;</span> <span class="p">:</span> <span class="n">Start</span><span class="p">,</span>
    <span class="s2">&quot;rstart&quot;</span> <span class="p">:</span> <span class="n">RStart</span><span class="p">,</span>
    <span class="s2">&quot;cstart&quot;</span> <span class="p">:</span> <span class="n">CStart</span><span class="p">,</span>
    <span class="s2">&quot;edoc&quot;</span> <span class="p">:</span> <span class="n">Edoc</span><span class="p">,</span>
    <span class="s2">&quot;end&quot;</span> <span class="p">:</span> <span class="n">End</span><span class="p">,</span>
    <span class="s2">&quot;include&quot;</span> <span class="p">:</span> <span class="n">Include</span><span class="p">,</span>
    <span class="s2">&quot;code&quot;</span> <span class="p">:</span> <span class="n">Code</span><span class="p">,</span>
    <span class="s2">&quot;ignore&quot;</span> <span class="p">:</span> <span class="n">Ignore</span><span class="p">,</span>
    <span class="s2">&quot;indent&quot;</span> <span class="p">:</span> <span class="n">Indent</span><span class="p">,</span>
    <span class="s2">&quot;if&quot;</span> <span class="p">:</span> <span class="n">If</span><span class="p">,</span>
    <span class="s2">&quot;fi&quot;</span> <span class="p">:</span> <span class="n">Fi</span><span class="p">,</span>
    <span class="s2">&quot;define&quot;</span> <span class="p">:</span> <span class="n">Define</span><span class="p">,</span>
    <span class="s2">&quot;enifed&quot;</span> <span class="p">:</span> <span class="n">Enifed</span><span class="p">,</span>
    <span class="s2">&quot;subst&quot;</span> <span class="p">:</span> <span class="n">Subst</span><span class="p">,</span>
    <span class="s2">&quot;rinclude&quot;</span> <span class="p">:</span> <span class="n">RInclude</span><span class="p">,</span>
    <span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id4">
<span id="id5"></span><h3>&lt;&lt;readers&gt;&gt;<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">&lt;&lt;</span><span class="n">Reader</span><span class="o">&gt;&gt;</span>
<span class="o">&lt;&lt;</span><span class="n">CReader</span><span class="o">&gt;&gt;</span>
<span class="o">&lt;&lt;</span><span class="n">CSharpReader</span><span class="o">&gt;&gt;</span>
<span class="o">&lt;&lt;</span><span class="n">ClojureReader</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">GenericReader</span><span class="o">&gt;&gt;</span>
<span class="o">&lt;&lt;</span><span class="n">rstReader</span><span class="o">&gt;&gt;</span>
<span class="o">&lt;&lt;</span><span class="n">PythonReader</span><span class="o">&gt;&gt;</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id6">
<h3>&lt;&lt;document&gt;&gt;<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">&lt;&lt;</span><span class="n">Document</span><span class="o">&gt;&gt;</span>
<span class="o">&lt;&lt;</span><span class="n">generate</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">get_comment_markers</span><span class="o">&gt;&gt;</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="multi-file-processing-and-sphinx-support">
<h2>Multi-File Processing and Sphinx Support<a class="headerlink" href="#multi-file-processing-and-sphinx-support" title="Permalink to this headline">¶</a></h2>
<p>antiweb supports Sphinx, which means that antiweb can provide you with an index.rst document that includes all processed files.
To use that feature you simple have to use the -i option. Additionally you can process multiple files at once with the -r option added.
The needed parameter then can be empty to use the current directory or you provide the directory antiweb should use.</p>
</div>
<div class="section" id="how-to-add-new-languages">
<h2>How to add new languages<a class="headerlink" href="#how-to-add-new-languages" title="Permalink to this headline">¶</a></h2>
<p>New languages are added by writing a new Reader class
and registering it in the readers dictionary (see readers).
A simple Reader example is provides by <a class="reference internal" href="#CReader" title="CReader"><code class="xref py py-class docutils literal"><span class="pre">CReader</span></code></a>
a more advances reader is <a class="reference internal" href="#PythonReader" title="PythonReader"><code class="xref py py-class docutils literal"><span class="pre">PythonReader</span></code></a>.</p>
<div class="section" id="language-specific-comment-markers">
<h3>Language specific comment markers<a class="headerlink" href="#language-specific-comment-markers" title="Permalink to this headline">¶</a></h3>
<p>If a new language is added, its comment markers also have to be registered in the following map.
The map contains the definition of all language specific comment markers.</p>
<p>The comment markers of a language are defined in the format:
<code class="docutils literal"><span class="pre">&quot;language&quot;</span> <span class="pre">:</span> <span class="pre">([single_comment_tokens],[start_block_token,</span> <span class="pre">end_block_token])</span></code></p>
<p>Multiple single and block comment markers can be defined.</p>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">comments</span> <span class="o">=</span> <span class="p">{</span>
<span class="s2">&quot;C&quot;</span> <span class="p">:</span> <span class="p">([</span><span class="s2">&quot;//&quot;</span><span class="p">],([</span><span class="s2">&quot;/*&quot;</span><span class="p">,</span><span class="s2">&quot;*/&quot;</span><span class="p">])),</span>
<span class="s2">&quot;C++&quot;</span> <span class="p">:</span> <span class="p">([</span><span class="s2">&quot;//&quot;</span><span class="p">],([</span><span class="s2">&quot;/*&quot;</span><span class="p">,</span><span class="s2">&quot;*/&quot;</span><span class="p">])),</span>
<span class="s2">&quot;C#&quot;</span> <span class="p">:</span> <span class="p">([</span><span class="s2">&quot;//&quot;</span><span class="p">],([</span><span class="s2">&quot;/*&quot;</span><span class="p">,</span><span class="s2">&quot;*/&quot;</span><span class="p">])),</span>
<span class="s2">&quot;Python&quot;</span> <span class="p">:</span> <span class="p">([</span><span class="s2">&quot;#&quot;</span><span class="p">],([</span><span class="s2">&quot;&#39;&#39;&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;&#39;&#39;&quot;</span><span class="p">],[</span><span class="s2">&quot;</span><span class="se">\&quot;\&quot;\&quot;</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\&quot;\&quot;\&quot;</span><span class="s2">&quot;</span><span class="p">])),</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>From the map above the comment markers are retrieved via the following method:</p>
<dl class="function">
<dt id="get_comment_markers">
<code class="descname">get_comment_markers</code><span class="sig-paren">(</span><em>lexer_name</em><span class="sig-paren">)</span><a class="headerlink" href="#get_comment_markers" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieves the language specific comment markers from the comments map.
The comment markers of C serves as the default comment markers if the lexer name cannot be found.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>lexer_name</strong> (<a class="reference external" href="https://docs.python.org/2/library/string.html#module-string" title="(in Python v2.7)"><em>string</em></a>) &#8211; The name of the pygments lexer.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">The single and comment block markers defined by the language</td>
</tr>
</tbody>
</table>
<div class="highlight-python3"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_comment_markers</span><span class="p">(</span><span class="n">lexer_name</span><span class="p">):</span>
    <span class="n">comment_markers</span> <span class="o">=</span> <span class="n">comments</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">lexer_name</span><span class="p">,</span> <span class="n">comments</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">])</span>
    <span class="n">single_comment_markers</span> <span class="o">=</span> <span class="n">comment_markers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">block_comment_markers</span> <span class="o">=</span> <span class="n">comment_markers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">single_comment_markers</span><span class="p">,</span>  <span class="n">block_comment_markers</span>
</pre></div>
</td></tr></table></div>
</dd></dl>

</div>
</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>See the <span class="xref std std-ref">antiweb</span> source as an advanced example.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="antisphinx.html" class="btn btn-neutral float-right" title="antisphinx" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="process_overview.html" class="btn btn-neutral" title="Process overview" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Michael Reithinger, Philipp Rathmanner, Lukas Tanner, Philipp Grandits, Christian Eitner.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.3.3',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>